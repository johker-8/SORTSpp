
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>dpt_tools &#8212; SORTS++ 3.0.0 documentation</title>
    <link rel="stylesheet" href="../_static/nature.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script async="async" type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" /> 
  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">SORTS++ 3.0.0 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="index.html" accesskey="U">Module code</a> &#187;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <h1>Source code for dpt_tools</h1><div class="highlight"><pre>
<span></span><span class="sd">&quot;&quot;&quot;Functions from Daniel&#39;s-Python-tools package</span>

<span class="sd">This is a module to enable simple plotting with kwargs as</span>
<span class="sd">configuration and includes coordinate transformations and other useful functions.</span>

<span class="sd"># TODO: Fix so orbits work with hyperbolic</span>
<span class="sd"># TODO: Fix the 0-e 0-i errors</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">import</span> <span class="nn">math</span>
<span class="kn">import</span> <span class="nn">time</span>
<span class="kn">import</span> <span class="nn">pdb</span>
<span class="kn">import</span> <span class="nn">os</span>

<span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s1">&#39;TZ&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;GMT&#39;</span>
<span class="n">time</span><span class="o">.</span><span class="n">tzset</span><span class="p">()</span>

<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">matplotlib</span> <span class="k">as</span> <span class="nn">mpl</span>
<span class="kn">import</span> <span class="nn">matplotlib.cm</span> <span class="k">as</span> <span class="nn">cm</span>
<span class="kn">import</span> <span class="nn">scipy.constants</span>
<span class="kn">from</span> <span class="nn">mpl_toolkits.mplot3d</span> <span class="k">import</span> <span class="n">Axes3D</span>
<span class="kn">from</span> <span class="nn">itertools</span> <span class="k">import</span> <span class="n">combinations</span>
<span class="kn">import</span> <span class="nn">plothelp</span>

<span class="n">M_earth</span> <span class="o">=</span> <span class="mf">398600.5e9</span><span class="o">/</span><span class="n">scipy</span><span class="o">.</span><span class="n">constants</span><span class="o">.</span><span class="n">G</span>
<span class="sd">&#39;&#39;&#39;float: Mass of the Earth using the WGS84 convention.</span>
<span class="sd">&#39;&#39;&#39;</span>

<span class="n">M_sol</span> <span class="o">=</span> <span class="mf">1.98847e30</span> <span class="c1">#kg</span>
<span class="sd">&quot;&quot;&quot;float: The mass of the sun :math:`M_\odot` given in kg, used in kepler transformations</span>
<span class="sd">&quot;&quot;&quot;</span>


<div class="viewcode-block" id="hist2d"><a class="viewcode-back" href="../modules/dpt_tools.html#dpt_tools.hist2d">[docs]</a><span class="k">def</span> <span class="nf">hist2d</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="o">**</span><span class="n">options</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;This function creates a histogram plot with lots of nice pre-configured settings unless they are overridden</span>

<span class="sd">    :param numpy.ndarray x:  data to histogram over, if x is not a vector it is flattened</span>
<span class="sd">    :param dict options: All keyword arguments as a dictionary containing all the optional settings.</span>

<span class="sd">    Currently the keyword arguments that can be used in the **options**:</span>
<span class="sd">        :bins [int]: the number of bins</span>
<span class="sd">        :colormap [str]: Name of colormap to use.</span>
<span class="sd">        :title [string]: the title of the plot</span>
<span class="sd">        :title_font_size [int]: the title font size</span>
<span class="sd">        :xlabel [string]: the label for the x axis</span>
<span class="sd">        :ylabel [string]: the label for the y axis</span>
<span class="sd">        :tick_font_size [int]: the axis tick font size</span>
<span class="sd">        :window [tuple/list]: the size of the plot window in pixels (assuming dpi = 80)</span>
<span class="sd">        :save [string]: will not display figure and will instead save it to this path</span>
<span class="sd">        :show [bool]: if False will do draw() instead of show() allowing script to continue</span>
<span class="sd">        :plot [tuple]: A tuple with the :code:`(fig, ax)` objects from matplotlib. Then no new figure and axis will be created.</span>
<span class="sd">        :logx [bool]: Determines if x-axis should be the logarithmic.</span>
<span class="sd">        :logy [bool]: Determines if y-axis should be the logarithmic.</span>
<span class="sd">        :log_freq [bool]: Determines if frequency should be the logarithmic.</span>

<span class="sd">    Example::</span>
<span class="sd">        </span>
<span class="sd">        import dpt_tools as dpt</span>
<span class="sd">        import numpy as np</span>
<span class="sd">        np.random.seed(19680221)</span>

<span class="sd">        x = 10*np.random.randn(1000)</span>

<span class="sd">        dpt.hist(x,</span>
<span class="sd">           title = &quot;My first plot&quot;,</span>
<span class="sd">        )</span>
<span class="sd">        </span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
        <span class="n">_x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">_x</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

    <span class="k">if</span> <span class="n">_x</span><span class="o">.</span><span class="n">size</span> <span class="o">!=</span> <span class="n">_x</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
        <span class="n">_x</span> <span class="o">=</span> <span class="n">_x</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>

    <span class="k">if</span> <span class="n">options</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s1">&#39;logx&#39;</span><span class="p">,</span> <span class="kc">False</span> <span class="p">):</span>
        <span class="n">_x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">_x</span><span class="p">)</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
        <span class="n">_y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">_y</span> <span class="o">=</span> <span class="n">y</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

    <span class="k">if</span> <span class="n">_y</span><span class="o">.</span><span class="n">size</span> <span class="o">!=</span> <span class="n">_y</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
        <span class="n">_y</span> <span class="o">=</span> <span class="n">_y</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>

    <span class="k">if</span> <span class="n">options</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s1">&#39;logy&#39;</span><span class="p">,</span> <span class="kc">False</span> <span class="p">):</span>
        <span class="n">_y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">_y</span><span class="p">)</span>


    <span class="c1">#turn on TeX interperter</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">rc</span><span class="p">(</span><span class="s1">&#39;text&#39;</span><span class="p">,</span> <span class="n">usetex</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="k">if</span> <span class="s1">&#39;window&#39;</span> <span class="ow">in</span> <span class="n">options</span><span class="p">:</span>
        <span class="n">size_in</span> <span class="o">=</span> <span class="n">options</span><span class="p">[</span><span class="s1">&#39;window&#39;</span><span class="p">]</span>
        <span class="n">size_in</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">sz</span><span class="o">/</span><span class="mf">80.0</span> <span class="k">for</span> <span class="n">sz</span> <span class="ow">in</span> <span class="n">size_in</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">size_in</span><span class="o">=</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span> <span class="mi">7</span><span class="p">)</span>
    <span class="k">if</span> <span class="s1">&#39;bin_size&#39;</span> <span class="ow">in</span> <span class="n">options</span><span class="p">:</span>
        <span class="n">options</span><span class="p">[</span><span class="s1">&#39;bins&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">((</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">_x</span><span class="p">)</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">_x</span><span class="p">))</span><span class="o">/</span><span class="n">options</span><span class="p">[</span><span class="s1">&#39;bin_size&#39;</span><span class="p">]))</span>

    <span class="k">if</span> <span class="s1">&#39;plot&#39;</span> <span class="ow">in</span> <span class="n">options</span><span class="p">:</span>
        <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">options</span><span class="p">[</span><span class="s1">&#39;plot&#39;</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="n">size_in</span><span class="p">,</span><span class="n">dpi</span><span class="o">=</span><span class="mi">80</span><span class="p">)</span>

    <span class="n">cmap</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">cm</span><span class="p">,</span> <span class="n">options</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s1">&#39;cmap&#39;</span><span class="p">,</span> <span class="s1">&#39;plasma&#39;</span><span class="p">))</span>

    <span class="k">if</span> <span class="n">options</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s1">&#39;log_freq&#39;</span><span class="p">,</span> <span class="kc">False</span> <span class="p">):</span>
        <span class="n">hst</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">hist2d</span><span class="p">(</span><span class="n">_x</span><span class="p">,</span> <span class="n">_y</span><span class="p">,</span>
            <span class="n">bins</span><span class="o">=</span><span class="n">options</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s1">&#39;bins&#39;</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">_x</span><span class="o">.</span><span class="n">size</span><span class="p">)))</span> <span class="p">),</span>
            <span class="n">cmap</span><span class="o">=</span><span class="n">cmap</span><span class="p">,</span>
            <span class="n">norm</span><span class="o">=</span><span class="n">mpl</span><span class="o">.</span><span class="n">colors</span><span class="o">.</span><span class="n">LogNorm</span><span class="p">(),</span>
        <span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_facecolor</span><span class="p">(</span><span class="n">cmap</span><span class="o">.</span><span class="n">colors</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">hst</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">hist2d</span><span class="p">(</span><span class="n">_x</span><span class="p">,</span> <span class="n">_y</span><span class="p">,</span>
            <span class="n">bins</span><span class="o">=</span><span class="n">options</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s1">&#39;bins&#39;</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">_x</span><span class="o">.</span><span class="n">size</span><span class="p">)))</span> <span class="p">),</span>
            <span class="n">cmap</span><span class="o">=</span><span class="n">cmap</span><span class="p">,</span>
            <span class="n">normed</span><span class="o">=</span><span class="n">options</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s1">&#39;pdf&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">),</span>
        <span class="p">)</span>
    <span class="n">title</span> <span class="o">=</span> <span class="n">options</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s1">&#39;title&#39;</span><span class="p">,</span><span class="s1">&#39;Data scatter plot&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">title</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">title</span><span class="p">,</span>
            <span class="n">fontsize</span><span class="o">=</span><span class="n">options</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s1">&#39;title_font_size&#39;</span><span class="p">,</span><span class="mi">24</span><span class="p">))</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="n">options</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s1">&#39;xlabel&#39;</span><span class="p">,</span><span class="s1">&#39;X-axis&#39;</span><span class="p">),</span> 
        <span class="n">fontsize</span><span class="o">=</span><span class="n">options</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s1">&#39;ax_font_size&#39;</span><span class="p">,</span><span class="mi">20</span><span class="p">))</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="n">options</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s1">&#39;ylabel&#39;</span><span class="p">,</span><span class="s1">&#39;Y-axis&#39;</span><span class="p">),</span>
            <span class="n">fontsize</span><span class="o">=</span><span class="n">options</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s1">&#39;ax_font_size&#39;</span><span class="p">,</span><span class="mi">20</span><span class="p">))</span>
    <span class="n">cbar</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">hst</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">options</span><span class="p">[</span><span class="s1">&#39;log_freq&#39;</span><span class="p">]:</span>
        <span class="n">cbar</span><span class="o">.</span><span class="n">set_label</span><span class="p">(</span><span class="n">options</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s1">&#39;clabel&#39;</span><span class="p">,</span><span class="s1">&#39;Logarithmic counts&#39;</span><span class="p">),</span>
            <span class="n">fontsize</span><span class="o">=</span><span class="n">options</span><span class="p">[</span><span class="s1">&#39;ax_font_size&#39;</span><span class="p">])</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">cbar</span><span class="o">.</span><span class="n">set_label</span><span class="p">(</span><span class="n">options</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s1">&#39;clabel&#39;</span><span class="p">,</span><span class="s1">&#39;Counts&#39;</span><span class="p">),</span>
            <span class="n">fontsize</span><span class="o">=</span><span class="n">options</span><span class="p">[</span><span class="s1">&#39;ax_font_size&#39;</span><span class="p">])</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="n">fontsize</span><span class="o">=</span><span class="n">options</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s1">&#39;tick_font_size&#39;</span><span class="p">,</span><span class="mi">16</span><span class="p">))</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">yticks</span><span class="p">(</span><span class="n">fontsize</span><span class="o">=</span><span class="n">options</span><span class="p">[</span><span class="s1">&#39;tick_font_size&#39;</span><span class="p">])</span>
    <span class="k">if</span> <span class="s1">&#39;save&#39;</span> <span class="ow">in</span> <span class="n">options</span><span class="p">:</span>
        <span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">options</span><span class="p">[</span><span class="s1">&#39;save&#39;</span><span class="p">],</span><span class="n">bbox_inches</span><span class="o">=</span><span class="s1">&#39;tight&#39;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">options</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s1">&#39;show&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">):</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">draw</span><span class="p">()</span>

    <span class="k">return</span> <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span></div>



<div class="viewcode-block" id="posterior"><a class="viewcode-back" href="../modules/dpt_tools.html#dpt_tools.posterior">[docs]</a><span class="k">def</span> <span class="nf">posterior</span><span class="p">(</span><span class="n">post</span><span class="p">,</span> <span class="n">variables</span><span class="p">,</span> <span class="o">**</span><span class="n">options</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;This function creates several scatter plots of a set of orbital elements based on the</span>
<span class="sd">    different possible axis planar projections, calculates all possible permutations of plane</span>
<span class="sd">    intersections based on the number of columns</span>

<span class="sd">    :param numpy.ndarray post: Rows are distinct variable samples and columns are variables in the order of :code:`variables`</span>
<span class="sd">    :param list variables: Name of variables, used for axis names.</span>
<span class="sd">    :param options:  dictionary containing all the optional settings</span>

<span class="sd">    Currently the options fields are:</span>
<span class="sd">        :bins [int]: the number of bins</span>
<span class="sd">        :colormap [str]: Name of colormap to use.</span>
<span class="sd">        :title [string]: the title of the plot</span>
<span class="sd">        :title_font_size [int]: the title font size</span>
<span class="sd">        :axis_labels [list of strings]: labels for each column</span>
<span class="sd">        :tick_font_size [int]: the axis tick font size</span>
<span class="sd">        :window [tuple/list]: the size of the plot window in pixels (assuming dpi = 80)</span>
<span class="sd">        :save [string]: will not display figure and will instead save it to this path</span>
<span class="sd">        :show [bool]: if False will do draw() instead of show() allowing script to continue</span>
<span class="sd">        :tight_rect [list of 4 floats]: configuration for the tight_layout function</span>


<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">post</span><span class="p">)</span> <span class="o">!=</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
        <span class="n">post</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">post</span><span class="p">)</span>

    <span class="c1">#turn on TeX interperter</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">rc</span><span class="p">(</span><span class="s1">&#39;text&#39;</span><span class="p">,</span> <span class="n">usetex</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="n">lis</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">post</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
    <span class="n">axis_plot</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">combinations</span><span class="p">(</span><span class="n">lis</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>

    <span class="n">axis_label</span> <span class="o">=</span> <span class="n">variables</span>
    
    <span class="k">if</span> <span class="n">post</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
        <span class="n">subplot_cnt</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span>
        <span class="n">subplot_perms</span> <span class="o">=</span> <span class="mi">2</span>
    <span class="k">elif</span> <span class="n">post</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
        <span class="n">subplot_cnt</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span>
        <span class="n">subplot_perms</span> <span class="o">=</span> <span class="mi">3</span>
    <span class="k">elif</span> <span class="n">post</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="mi">4</span><span class="p">:</span>
        <span class="n">subplot_cnt</span> <span class="o">=</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span>
        <span class="n">subplot_perms</span> <span class="o">=</span> <span class="mi">6</span>
    <span class="k">elif</span> <span class="n">post</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="mi">5</span><span class="p">:</span>
        <span class="n">subplot_cnt</span> <span class="o">=</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">5</span><span class="p">)</span>
        <span class="n">subplot_perms</span> <span class="o">=</span> <span class="mi">10</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">subplot_cnt</span> <span class="o">=</span> <span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">5</span><span class="p">)</span>
        <span class="n">subplot_perms</span> <span class="o">=</span> <span class="mi">15</span>
    <span class="n">subplot_cnt_ind</span> <span class="o">=</span> <span class="mi">1</span>

    <span class="k">if</span> <span class="s1">&#39;window&#39;</span> <span class="ow">in</span> <span class="n">options</span><span class="p">:</span>
        <span class="n">size_in</span> <span class="o">=</span> <span class="n">options</span><span class="p">[</span><span class="s1">&#39;window&#39;</span><span class="p">]</span>
        <span class="n">size_in</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">x</span><span class="o">/</span><span class="mf">80.0</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">size_in</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">size_in</span><span class="o">=</span><span class="p">(</span><span class="mi">19</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>

    <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="n">size_in</span><span class="p">,</span><span class="n">dpi</span><span class="o">=</span><span class="mi">80</span><span class="p">)</span>

    <span class="n">cmap</span> <span class="o">=</span> <span class="n">options</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s1">&#39;cmap&#39;</span><span class="p">,</span> <span class="s1">&#39;plasma&#39;</span><span class="p">)</span>
    <span class="n">bins</span> <span class="o">=</span> <span class="n">options</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s1">&#39;bins&#39;</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">post</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])))</span> <span class="p">)</span>

    <span class="n">fig</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="n">options</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s1">&#39;title&#39;</span><span class="p">,</span><span class="s1">&#39;Probability distribution&#39;</span><span class="p">),</span>
        <span class="n">fontsize</span><span class="o">=</span><span class="n">options</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s1">&#39;title_font_size&#39;</span><span class="p">,</span><span class="mi">24</span><span class="p">))</span>
    <span class="n">axes</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">I</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span> <span class="n">subplot_perms</span> <span class="p">):</span>
        <span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="n">subplot_cnt</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">subplot_cnt</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">subplot_cnt_ind</span><span class="p">)</span>
        <span class="n">axes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ax</span><span class="p">)</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">post</span><span class="p">[:,</span><span class="n">axis_plot</span><span class="p">[</span><span class="n">I</span><span class="p">][</span><span class="mi">0</span><span class="p">]]</span>
        <span class="n">y</span> <span class="o">=</span> <span class="n">post</span><span class="p">[:,</span><span class="n">axis_plot</span><span class="p">[</span><span class="n">I</span><span class="p">][</span><span class="mi">1</span><span class="p">]]</span>
        <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">hist2d</span><span class="p">(</span>
            <span class="n">x</span><span class="o">.</span><span class="n">flatten</span><span class="p">(),</span>
            <span class="n">y</span><span class="o">.</span><span class="n">flatten</span><span class="p">(),</span>
            <span class="n">bins</span><span class="o">=</span><span class="n">bins</span><span class="p">,</span>
            <span class="n">cmap</span><span class="o">=</span><span class="n">cmap</span><span class="p">,</span>
            <span class="n">plot</span><span class="o">=</span><span class="p">(</span><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span><span class="p">),</span>
            <span class="n">pdf</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="n">clabel</span><span class="o">=</span><span class="s1">&#39;Probability&#39;</span><span class="p">,</span>
            <span class="n">title</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
            <span class="n">show</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="n">axis_label</span><span class="p">[</span><span class="n">axis_plot</span><span class="p">[</span><span class="n">I</span><span class="p">][</span><span class="mi">0</span><span class="p">]],</span> 
            <span class="n">fontsize</span><span class="o">=</span><span class="n">options</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s1">&#39;ax_font_size&#39;</span><span class="p">,</span><span class="mi">22</span><span class="p">))</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="n">axis_label</span><span class="p">[</span><span class="n">axis_plot</span><span class="p">[</span><span class="n">I</span><span class="p">][</span><span class="mi">1</span><span class="p">]],</span> 
            <span class="n">fontsize</span><span class="o">=</span><span class="n">options</span><span class="p">[</span><span class="s1">&#39;ax_font_size&#39;</span><span class="p">])</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="n">fontsize</span><span class="o">=</span><span class="n">options</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s1">&#39;tick_font_size&#39;</span><span class="p">,</span><span class="mi">17</span><span class="p">))</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">yticks</span><span class="p">(</span><span class="n">fontsize</span><span class="o">=</span><span class="n">options</span><span class="p">[</span><span class="s1">&#39;tick_font_size&#39;</span><span class="p">])</span>
        <span class="n">subplot_cnt_ind</span> <span class="o">+=</span> <span class="mi">1</span>
    
    <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">(</span><span class="n">rect</span><span class="o">=</span><span class="n">options</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s1">&#39;tight_rect&#39;</span><span class="p">,[</span><span class="mi">0</span><span class="p">,</span> <span class="mf">0.03</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mf">0.95</span><span class="p">]))</span>

    <span class="k">if</span> <span class="s1">&#39;save&#39;</span> <span class="ow">in</span> <span class="n">options</span><span class="p">:</span>
        <span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">options</span><span class="p">[</span><span class="s1">&#39;save&#39;</span><span class="p">],</span><span class="n">bbox_inches</span><span class="o">=</span><span class="s1">&#39;tight&#39;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">options</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s1">&#39;show&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">):</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">draw</span><span class="p">()</span>

    <span class="k">return</span> <span class="n">fig</span><span class="p">,</span> <span class="n">axes</span></div>



<div class="viewcode-block" id="hist"><a class="viewcode-back" href="../modules/dpt_tools.html#dpt_tools.hist">[docs]</a><span class="k">def</span> <span class="nf">hist</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="o">**</span><span class="n">options</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;This function creates a histogram plot with lots of nice pre-configured settings unless they are overridden</span>

<span class="sd">    :param numpy.ndarray x:  data to histogram over, if x is not a vector it is flattened</span>
<span class="sd">    :param dict options: All keyword arguments as a dictionary containing all the optional settings.</span>

<span class="sd">    Currently the keyword arguments that can be used in the **options**:</span>
<span class="sd">        :bins [int]: the number of bins</span>
<span class="sd">        :density [bool]: convert counts to density in [0,1]</span>
<span class="sd">        :edges [float]: bin edge line width, set to 0 to remove edges</span>
<span class="sd">        :title [string]: the title of the plot</span>
<span class="sd">        :title_font_size [int]: the title font size</span>
<span class="sd">        :xlabel [string]: the label for the x axis</span>
<span class="sd">        :ylabel [string]: the label for the y axis</span>
<span class="sd">        :tick_font_size [int]: the axis tick font size</span>
<span class="sd">        :window [tuple/list]: the size of the plot window in pixels (assuming dpi = 80)</span>
<span class="sd">        :save [string]: will not display figure and will instead save it to this path</span>
<span class="sd">        :show [bool]: if False will do draw() instead of show() allowing script to continue</span>
<span class="sd">        :plot [tuple]: A tuple with the :code:`(fig, ax)` objects from matplotlib. Then no new figure and axis will be created.</span>
<span class="sd">        :logx [bool]: Determines if x-axis should be the logarithmic.</span>
<span class="sd">        :logy [bool]: Determines if y-axis should be the logarithmic.</span>

<span class="sd">    Example::</span>
<span class="sd">        </span>
<span class="sd">        import dpt_tools as dpt</span>
<span class="sd">        import numpy as np</span>
<span class="sd">        np.random.seed(19680221)</span>

<span class="sd">        x = 10*np.random.randn(1000)</span>

<span class="sd">        dpt.hist(x,</span>
<span class="sd">           title = &quot;My first plot&quot;,</span>
<span class="sd">        )</span>
<span class="sd">        </span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
        <span class="n">_x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">_x</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

    <span class="k">if</span> <span class="n">_x</span><span class="o">.</span><span class="n">size</span> <span class="o">!=</span> <span class="n">_x</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
        <span class="n">_x</span> <span class="o">=</span> <span class="n">_x</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>

    <span class="k">if</span> <span class="n">options</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s1">&#39;logx&#39;</span><span class="p">,</span> <span class="kc">False</span> <span class="p">):</span>
        <span class="n">_x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">_x</span><span class="p">)</span>

    <span class="c1">#turn on TeX interperter</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">rc</span><span class="p">(</span><span class="s1">&#39;text&#39;</span><span class="p">,</span> <span class="n">usetex</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="k">if</span> <span class="s1">&#39;window&#39;</span> <span class="ow">in</span> <span class="n">options</span><span class="p">:</span>
        <span class="n">size_in</span> <span class="o">=</span> <span class="n">options</span><span class="p">[</span><span class="s1">&#39;window&#39;</span><span class="p">]</span>
        <span class="n">size_in</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">sz</span><span class="o">/</span><span class="mf">80.0</span> <span class="k">for</span> <span class="n">sz</span> <span class="ow">in</span> <span class="n">size_in</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">size_in</span><span class="o">=</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span> <span class="mi">7</span><span class="p">)</span>
    <span class="k">if</span> <span class="s1">&#39;bin_size&#39;</span> <span class="ow">in</span> <span class="n">options</span><span class="p">:</span>
        <span class="n">options</span><span class="p">[</span><span class="s1">&#39;bins&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">((</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">_x</span><span class="p">)</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">_x</span><span class="p">))</span><span class="o">/</span><span class="n">options</span><span class="p">[</span><span class="s1">&#39;bin_size&#39;</span><span class="p">]))</span>

    <span class="k">if</span> <span class="s1">&#39;plot&#39;</span> <span class="ow">in</span> <span class="n">options</span><span class="p">:</span>
        <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">options</span><span class="p">[</span><span class="s1">&#39;plot&#39;</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="n">size_in</span><span class="p">,</span><span class="n">dpi</span><span class="o">=</span><span class="mi">80</span><span class="p">)</span>

    <span class="n">ax</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">_x</span><span class="p">,</span>
        <span class="n">options</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s1">&#39;bins&#39;</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">_x</span><span class="o">.</span><span class="n">size</span><span class="p">)))</span> <span class="p">),</span>
        <span class="n">density</span><span class="o">=</span><span class="n">options</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s1">&#39;density&#39;</span><span class="p">,</span><span class="kc">False</span><span class="p">),</span>
        <span class="n">facecolor</span><span class="o">=</span><span class="n">options</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s1">&#39;color&#39;</span><span class="p">,</span><span class="s1">&#39;b&#39;</span><span class="p">),</span>
        <span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span>
        <span class="n">linewidth</span><span class="o">=</span><span class="n">options</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s1">&#39;edges&#39;</span><span class="p">,</span><span class="mf">1.2</span><span class="p">),</span>
        <span class="n">cumulative</span><span class="o">=</span><span class="n">options</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s1">&#39;cumulative&#39;</span><span class="p">,</span><span class="kc">False</span><span class="p">),</span>
        <span class="n">log</span><span class="o">=</span><span class="n">options</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s1">&#39;logy&#39;</span><span class="p">,</span> <span class="kc">False</span> <span class="p">),</span>
        <span class="n">label</span><span class="o">=</span><span class="n">options</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s1">&#39;label&#39;</span><span class="p">,</span> <span class="kc">None</span> <span class="p">),</span>
        <span class="n">alpha</span><span class="o">=</span><span class="n">options</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s1">&#39;alpha&#39;</span><span class="p">,</span><span class="mf">1.0</span><span class="p">),</span>
    <span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">options</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s1">&#39;title&#39;</span><span class="p">,</span><span class="s1">&#39;Data scatter plot&#39;</span><span class="p">),</span>\
        <span class="n">fontsize</span><span class="o">=</span><span class="n">options</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s1">&#39;title_font_size&#39;</span><span class="p">,</span><span class="mi">24</span><span class="p">))</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="n">options</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s1">&#39;xlabel&#39;</span><span class="p">,</span><span class="s1">&#39;X-axis&#39;</span><span class="p">),</span> \
        <span class="n">fontsize</span><span class="o">=</span><span class="n">options</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s1">&#39;ax_font_size&#39;</span><span class="p">,</span><span class="mi">20</span><span class="p">))</span>
    <span class="k">if</span> <span class="n">options</span><span class="p">[</span><span class="s1">&#39;density&#39;</span><span class="p">]:</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="n">options</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s1">&#39;ylabel&#39;</span><span class="p">,</span><span class="s1">&#39;Density&#39;</span><span class="p">),</span> \
            <span class="n">fontsize</span><span class="o">=</span><span class="n">options</span><span class="p">[</span><span class="s1">&#39;ax_font_size&#39;</span><span class="p">])</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="n">options</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s1">&#39;ylabel&#39;</span><span class="p">,</span><span class="s1">&#39;Frequency&#39;</span><span class="p">),</span> \
            <span class="n">fontsize</span><span class="o">=</span><span class="n">options</span><span class="p">[</span><span class="s1">&#39;ax_font_size&#39;</span><span class="p">])</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="n">fontsize</span><span class="o">=</span><span class="n">options</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s1">&#39;tick_font_size&#39;</span><span class="p">,</span><span class="mi">16</span><span class="p">))</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">yticks</span><span class="p">(</span><span class="n">fontsize</span><span class="o">=</span><span class="n">options</span><span class="p">[</span><span class="s1">&#39;tick_font_size&#39;</span><span class="p">])</span>
    <span class="k">if</span> <span class="s1">&#39;save&#39;</span> <span class="ow">in</span> <span class="n">options</span><span class="p">:</span>
        <span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">options</span><span class="p">[</span><span class="s1">&#39;save&#39;</span><span class="p">],</span><span class="n">bbox_inches</span><span class="o">=</span><span class="s1">&#39;tight&#39;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">options</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s1">&#39;show&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">):</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">draw</span><span class="p">()</span>

    <span class="k">return</span> <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span></div>


<div class="viewcode-block" id="scatter"><a class="viewcode-back" href="../modules/dpt_tools.html#dpt_tools.scatter">[docs]</a><span class="k">def</span> <span class="nf">scatter</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="o">**</span><span class="n">options</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;This function creates a scatter plot with lots of nice pre-configured settings unless they are overridden</span>

<span class="sd">    Currently the options fields are:</span>
<span class="sd">        :marker [char]: The marker type</span>
<span class="sd">        :size [int]: The size of the marker</span>
<span class="sd">        :alpha [float]: The transparency of the points.</span>
<span class="sd">        :title [string]: The title of the plot</span>
<span class="sd">        :title_font_size [int]: The title font size</span>
<span class="sd">        :xlabel [string]: The label for the x axis</span>
<span class="sd">        :ylabel [string]: The label for the y axis</span>
<span class="sd">        :tick_font_size [int]: The axis tick font size</span>
<span class="sd">        :window [tuple/list]: The size of the plot window in pixels (assuming dpi = 80)</span>
<span class="sd">        :save [string]: Will not display figure and will instead save it to this path</span>
<span class="sd">        :show [bool]: If False will do draw() instead of show() allowing script to continue</span>
<span class="sd">        :plot [tuple]: A tuple with the :code:`(fig, ax)` objects from matplotlib. Then no new figure and axis will be created.</span>

<span class="sd">    :param numpy.ndarray x:  x-axis data vector.</span>
<span class="sd">    :param numpy.ndarray y:  y-axis data vector.</span>
<span class="sd">    :param options:  dictionary containing all the optional settings.</span>

<span class="sd">    Example::</span>
<span class="sd">        </span>
<span class="sd">        import dpt_tools as dpt</span>
<span class="sd">        import numpy as np</span>
<span class="sd">        np.random.seed(19680221)</span>

<span class="sd">        x = 10*np.random.randn(100)</span>
<span class="sd">        y = 10*np.random.randn(100)</span>

<span class="sd">        dpt.scatter(x, y, {</span>
<span class="sd">            &quot;title&quot;: &quot;My first plot&quot;,</span>
<span class="sd">            } )</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">!=</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">y</span><span class="p">)</span> <span class="o">!=</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
        <span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>

    <span class="c1">#turn on TeX interperter</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">rc</span><span class="p">(</span><span class="s1">&#39;text&#39;</span><span class="p">,</span> <span class="n">usetex</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="k">if</span> <span class="s1">&#39;window&#39;</span> <span class="ow">in</span> <span class="n">options</span><span class="p">:</span>
        <span class="n">size_in</span> <span class="o">=</span> <span class="n">options</span><span class="p">[</span><span class="s1">&#39;window&#39;</span><span class="p">]</span>
        <span class="n">size_in</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">x</span><span class="o">/</span><span class="mf">80.0</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">size_in</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">size_in</span><span class="o">=</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span> <span class="mi">7</span><span class="p">)</span>

    <span class="k">if</span> <span class="s1">&#39;plot&#39;</span> <span class="ow">in</span> <span class="n">options</span><span class="p">:</span>
        <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">options</span><span class="p">[</span><span class="s1">&#39;plot&#39;</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="n">size_in</span><span class="p">,</span><span class="n">dpi</span><span class="o">=</span><span class="mi">80</span><span class="p">)</span>

    <span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">([</span><span class="n">x</span><span class="p">],</span> <span class="p">[</span><span class="n">y</span><span class="p">],</span>
        <span class="n">marker</span><span class="o">=</span><span class="n">options</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s1">&#39;marker&#39;</span><span class="p">,</span><span class="s1">&#39;.&#39;</span><span class="p">),</span>
        <span class="n">c</span><span class="o">=</span><span class="n">options</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s1">&#39;color&#39;</span><span class="p">,</span><span class="s1">&#39;b&#39;</span><span class="p">),</span>
        <span class="n">s</span><span class="o">=</span><span class="n">options</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s1">&#39;size&#39;</span><span class="p">,</span><span class="mi">2</span><span class="p">),</span>
        <span class="n">alpha</span><span class="o">=</span><span class="n">options</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s1">&#39;alpha&#39;</span><span class="p">,</span><span class="mf">0.75</span><span class="p">),</span>
    <span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">options</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s1">&#39;title&#39;</span><span class="p">,</span><span class="s1">&#39;Data scatter plot&#39;</span><span class="p">),</span>
        <span class="n">fontsize</span><span class="o">=</span><span class="n">options</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s1">&#39;title_font_size&#39;</span><span class="p">,</span><span class="mi">24</span><span class="p">))</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="n">options</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s1">&#39;xlabel&#39;</span><span class="p">,</span><span class="s1">&#39;X-axis&#39;</span><span class="p">),</span>
        <span class="n">fontsize</span><span class="o">=</span><span class="n">options</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s1">&#39;ax_font_size&#39;</span><span class="p">,</span><span class="mi">20</span><span class="p">))</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="n">options</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s1">&#39;ylabel&#39;</span><span class="p">,</span><span class="s1">&#39;Y-axis&#39;</span><span class="p">),</span>
        <span class="n">fontsize</span><span class="o">=</span><span class="n">options</span><span class="p">[</span><span class="s1">&#39;ax_font_size&#39;</span><span class="p">])</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="n">fontsize</span><span class="o">=</span><span class="n">options</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s1">&#39;tick_font_size&#39;</span><span class="p">,</span><span class="mi">16</span><span class="p">))</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">yticks</span><span class="p">(</span><span class="n">fontsize</span><span class="o">=</span><span class="n">options</span><span class="p">[</span><span class="s1">&#39;tick_font_size&#39;</span><span class="p">])</span>
    <span class="k">if</span> <span class="s1">&#39;save&#39;</span> <span class="ow">in</span> <span class="n">options</span><span class="p">:</span>
        <span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">options</span><span class="p">[</span><span class="s1">&#39;save&#39;</span><span class="p">],</span><span class="n">bbox_inches</span><span class="o">=</span><span class="s1">&#39;tight&#39;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">options</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s1">&#39;show&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">):</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">draw</span><span class="p">()</span>

    <span class="k">return</span> <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span></div>


<div class="viewcode-block" id="orbits"><a class="viewcode-back" href="../modules/dpt_tools.html#dpt_tools.orbits">[docs]</a><span class="k">def</span> <span class="nf">orbits</span><span class="p">(</span><span class="n">o</span><span class="p">,</span> <span class="o">**</span><span class="n">options</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;This function creates several scatter plots of a set of orbital elements based on the</span>
<span class="sd">    different possible axis planar projections, calculates all possible permutations of plane</span>
<span class="sd">    intersections based on the number of columns</span>

<span class="sd">    :param numpy.ndarray o: Rows are distinct orbits and columns are orbital elements in the order a, e, i, omega, Omega</span>
<span class="sd">    :param options:  dictionary containing all the optional settings</span>

<span class="sd">    Currently the options fields are:</span>
<span class="sd">        :marker [char]: the marker type</span>
<span class="sd">        :size [int]: the size of the marker</span>
<span class="sd">        :title [string]: the title of the plot</span>
<span class="sd">        :title_font_size [int]: the title font size</span>
<span class="sd">        :axis_labels [list of strings]: labels for each column</span>
<span class="sd">        :tick_font_size [int]: the axis tick font size</span>
<span class="sd">        :window [tuple/list]: the size of the plot window in pixels (assuming dpi = 80)</span>
<span class="sd">        :save [string]: will not display figure and will instead save it to this path</span>
<span class="sd">        :show [bool]: if False will do draw() instead of show() allowing script to continue</span>
<span class="sd">        :tight_rect [list of 4 floats]: configuration for the tight_layout function</span>


<span class="sd">    Example::</span>
<span class="sd">        </span>
<span class="sd">        import dpt_tools as dpt</span>
<span class="sd">        import numpy as np</span>
<span class="sd">        np.random.seed(19680221)</span>

<span class="sd">        orbs = np.matrix([</span>
<span class="sd">            11  + 3  *np.random.randn(1000),</span>
<span class="sd">            0.5 + 0.2*np.random.randn(1000),</span>
<span class="sd">            60  + 10 *np.random.randn(1000),</span>
<span class="sd">            120 + 5  *np.random.randn(1000),</span>
<span class="sd">            33  + 2  *np.random.randn(1000),</span>
<span class="sd">        ]).T</span>

<span class="sd">        dpt.orbits(orbs,</span>
<span class="sd">            title = &quot;My orbital element distribution&quot;,</span>
<span class="sd">            size = 10,</span>
<span class="sd">        )</span>


<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">o</span><span class="p">)</span> <span class="o">!=</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
        <span class="n">o</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">o</span><span class="p">)</span>

    <span class="k">if</span> <span class="s1">&#39;unit&#39;</span> <span class="ow">in</span> <span class="n">options</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">options</span><span class="p">[</span><span class="s1">&#39;unit&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;km&#39;</span><span class="p">:</span>
            <span class="n">o</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">o</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span><span class="o">/</span><span class="mf">6353.0</span>
        <span class="k">elif</span> <span class="n">options</span><span class="p">[</span><span class="s1">&#39;unit&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;m&#39;</span><span class="p">:</span>
            <span class="n">o</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">o</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span><span class="o">/</span><span class="mf">6353.0e3</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">o</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">o</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span><span class="o">/</span><span class="mf">6353.0</span>

    <span class="c1">#turn on TeX interperter</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">rc</span><span class="p">(</span><span class="s1">&#39;text&#39;</span><span class="p">,</span> <span class="n">usetex</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="n">lis</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">o</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
    <span class="n">axis_plot</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">combinations</span><span class="p">(</span><span class="n">lis</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>

    <span class="n">axis_label</span> <span class="o">=</span> <span class="n">options</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s1">&#39;axis_labels&#39;</span><span class="p">,</span> \
        <span class="p">[</span> <span class="s2">&quot;$a$ [$R_E$]&quot;</span><span class="p">,</span><span class="s2">&quot;$e$ [1]&quot;</span><span class="p">,</span><span class="s2">&quot;$i$ [deg]&quot;</span><span class="p">,</span><span class="s2">&quot;$\omega$ [deg]&quot;</span><span class="p">,</span><span class="s2">&quot;$\Omega$ [deg]&quot;</span><span class="p">,</span><span class="s2">&quot;$M_0$ [deg]&quot;</span> <span class="p">])</span>
    
    <span class="k">if</span> <span class="n">o</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
        <span class="n">subplot_cnt</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span>
        <span class="n">subplot_perms</span> <span class="o">=</span> <span class="mi">2</span>
    <span class="k">elif</span> <span class="n">o</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
        <span class="n">subplot_cnt</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span>
        <span class="n">subplot_perms</span> <span class="o">=</span> <span class="mi">3</span>
    <span class="k">elif</span> <span class="n">o</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="mi">4</span><span class="p">:</span>
        <span class="n">subplot_cnt</span> <span class="o">=</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span>
        <span class="n">subplot_perms</span> <span class="o">=</span> <span class="mi">6</span>
    <span class="k">elif</span> <span class="n">o</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="mi">5</span><span class="p">:</span>
        <span class="n">subplot_cnt</span> <span class="o">=</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">5</span><span class="p">)</span>
        <span class="n">subplot_perms</span> <span class="o">=</span> <span class="mi">10</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">subplot_cnt</span> <span class="o">=</span> <span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">5</span><span class="p">)</span>
        <span class="n">subplot_perms</span> <span class="o">=</span> <span class="mi">15</span>
    <span class="n">subplot_cnt_ind</span> <span class="o">=</span> <span class="mi">1</span>

    <span class="k">if</span> <span class="s1">&#39;window&#39;</span> <span class="ow">in</span> <span class="n">options</span><span class="p">:</span>
        <span class="n">size_in</span> <span class="o">=</span> <span class="n">options</span><span class="p">[</span><span class="s1">&#39;window&#39;</span><span class="p">]</span>
        <span class="n">size_in</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">x</span><span class="o">/</span><span class="mf">80.0</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">size_in</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">size_in</span><span class="o">=</span><span class="p">(</span><span class="mi">19</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>

    <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="n">size_in</span><span class="p">,</span><span class="n">dpi</span><span class="o">=</span><span class="mi">80</span><span class="p">)</span>

    <span class="n">fig</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="n">options</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s1">&#39;title&#39;</span><span class="p">,</span><span class="s1">&#39;Orbital elements distribution&#39;</span><span class="p">),</span>\
        <span class="n">fontsize</span><span class="o">=</span><span class="n">options</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s1">&#39;title_font_size&#39;</span><span class="p">,</span><span class="mi">24</span><span class="p">))</span>
    <span class="n">axes</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">I</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span> <span class="n">subplot_perms</span> <span class="p">):</span>
        <span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="n">subplot_cnt</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">subplot_cnt</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">subplot_cnt_ind</span><span class="p">)</span>
        <span class="n">axes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ax</span><span class="p">)</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">o</span><span class="p">[:,</span><span class="n">axis_plot</span><span class="p">[</span><span class="n">I</span><span class="p">][</span><span class="mi">0</span><span class="p">]]</span>
        <span class="n">y</span> <span class="o">=</span> <span class="n">o</span><span class="p">[:,</span><span class="n">axis_plot</span><span class="p">[</span><span class="n">I</span><span class="p">][</span><span class="mi">1</span><span class="p">]]</span>
        <span class="n">sc</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span> \
            <span class="n">x</span><span class="o">.</span><span class="n">flatten</span><span class="p">(),</span> \
            <span class="n">y</span><span class="o">.</span><span class="n">flatten</span><span class="p">(),</span> \
            <span class="n">marker</span><span class="o">=</span><span class="n">options</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s1">&#39;marker&#39;</span><span class="p">,</span><span class="s1">&#39;.&#39;</span><span class="p">),</span>\
            <span class="n">c</span><span class="o">=</span><span class="n">options</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s1">&#39;color&#39;</span><span class="p">,</span><span class="s1">&#39;b&#39;</span><span class="p">),</span>\
            <span class="n">s</span><span class="o">=</span><span class="n">options</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s1">&#39;size&#39;</span><span class="p">,</span><span class="mi">2</span><span class="p">))</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">options</span><span class="p">[</span><span class="s1">&#39;color&#39;</span><span class="p">],</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">sc</span><span class="p">)</span>
        <span class="n">x_ticks</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">o</span><span class="p">[:,</span><span class="n">axis_plot</span><span class="p">[</span><span class="n">I</span><span class="p">][</span><span class="mi">0</span><span class="p">]]),</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">o</span><span class="p">[:,</span><span class="n">axis_plot</span><span class="p">[</span><span class="n">I</span><span class="p">][</span><span class="mi">0</span><span class="p">]]),</span> <span class="n">num</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span> <span class="p">[</span><span class="nb">round</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">x_ticks</span><span class="p">]</span> <span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="n">axis_label</span><span class="p">[</span><span class="n">axis_plot</span><span class="p">[</span><span class="n">I</span><span class="p">][</span><span class="mi">0</span><span class="p">]],</span> \
            <span class="n">fontsize</span><span class="o">=</span><span class="n">options</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s1">&#39;ax_font_size&#39;</span><span class="p">,</span><span class="mi">22</span><span class="p">))</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="n">axis_label</span><span class="p">[</span><span class="n">axis_plot</span><span class="p">[</span><span class="n">I</span><span class="p">][</span><span class="mi">1</span><span class="p">]],</span> \
            <span class="n">fontsize</span><span class="o">=</span><span class="n">options</span><span class="p">[</span><span class="s1">&#39;ax_font_size&#39;</span><span class="p">])</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="n">fontsize</span><span class="o">=</span><span class="n">options</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s1">&#39;tick_font_size&#39;</span><span class="p">,</span><span class="mi">17</span><span class="p">))</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">yticks</span><span class="p">(</span><span class="n">fontsize</span><span class="o">=</span><span class="n">options</span><span class="p">[</span><span class="s1">&#39;tick_font_size&#39;</span><span class="p">])</span>
        <span class="n">subplot_cnt_ind</span> <span class="o">+=</span> <span class="mi">1</span>
    
    <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">(</span><span class="n">rect</span><span class="o">=</span><span class="n">options</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s1">&#39;tight_rect&#39;</span><span class="p">,[</span><span class="mi">0</span><span class="p">,</span> <span class="mf">0.03</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mf">0.95</span><span class="p">]))</span>


    <span class="k">if</span> <span class="s1">&#39;unit&#39;</span> <span class="ow">in</span> <span class="n">options</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">options</span><span class="p">[</span><span class="s1">&#39;unit&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;km&#39;</span><span class="p">:</span>
            <span class="n">o</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">o</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="mf">6353.0</span>
        <span class="k">elif</span> <span class="n">options</span><span class="p">[</span><span class="s1">&#39;unit&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;m&#39;</span><span class="p">:</span>
            <span class="n">o</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">o</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="mf">6353.0e3</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">o</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">o</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="mf">6353.0</span>

    <span class="k">if</span> <span class="s1">&#39;save&#39;</span> <span class="ow">in</span> <span class="n">options</span><span class="p">:</span>
        <span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">options</span><span class="p">[</span><span class="s1">&#39;save&#39;</span><span class="p">],</span><span class="n">bbox_inches</span><span class="o">=</span><span class="s1">&#39;tight&#39;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">options</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s1">&#39;show&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">):</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">draw</span><span class="p">()</span>

    <span class="k">return</span> <span class="n">fig</span><span class="p">,</span> <span class="n">axes</span></div>

<span class="k">def</span> <span class="nf">_np_vec_norm</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">axis</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">x</span><span class="o">**</span><span class="mi">2</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="n">axis</span><span class="p">))</span>


<span class="n">e_lim</span> <span class="o">=</span> <span class="mf">1e-9</span>
<span class="sd">&quot;&quot;&quot;float: The limit on eccentricity below witch an orbit is considered circular</span>
<span class="sd">&quot;&quot;&quot;</span>


<span class="n">i_lim</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="mf">1e-9</span>
<span class="sd">&quot;&quot;&quot;float: The limit on inclination below witch an orbit is considered not inclined.</span>
<span class="sd">&quot;&quot;&quot;</span>


<div class="viewcode-block" id="cart2kep"><a class="viewcode-back" href="../modules/dpt_tools.html#dpt_tools.cart2kep">[docs]</a><span class="k">def</span> <span class="nf">cart2kep</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">m</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">M_cent</span><span class="o">=</span><span class="n">M_sol</span><span class="p">,</span> <span class="n">radians</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Converts set of Cartesian state vectors to set of Keplerian orbital elements.</span>

<span class="sd">    **Units:**</span>
<span class="sd">       All units are SI-units: `SI Units &lt;https://www.nist.gov/pml/weights-and-measures/metric-si/si-units&gt;`_</span>

<span class="sd">       Angles are by default given as radians, all angles are radians internally in functions, input and output angles can be both radians and degrees depending on the :code:`radians` boolean.</span>

<span class="sd">    **Orientation of the ellipse in the coordinate system:**</span>
<span class="sd">       * For zero inclination :math:`i`: the ellipse is located in the x-y plane.</span>
<span class="sd">       * The direction of motion as True anoamly :math:`\\nu`: increases for a zero inclination :math:`i`: orbit is anti-coockwise, i.e. from +x towards +y.</span>
<span class="sd">       * If the eccentricity :math:`e`: is increased, the periapsis will lie in +x direction.</span>
<span class="sd">       * If the inclination :math:`i`: is increased, the ellipse will rotate around the x-axis, so that +y is rotated toward +z.</span>
<span class="sd">       * An increase in Longitude of ascending node :math:`\Omega`: corresponds to a rotation around the z-axis so that +x is rotated toward +y.</span>
<span class="sd">       * Changing argument of perihelion :math:`\omega`: will not change the plane of the orbit, it will rotate the orbit in the plane.</span>
<span class="sd">       * The periapsis is shifted in the direction of motion.</span>
<span class="sd">       * True anomaly measures from the +x axis, i.e :math:`\\nu = 0` is located at periapsis and :math:`\\nu = \pi` at apoapsis.</span>
<span class="sd">       * All anomalies and orientation angles reach between 0 and :math:`2\pi`</span>

<span class="sd">       *Reference:* &quot;Orbital Motion&quot; by A.E. Roy.</span>
<span class="sd">    </span>

<span class="sd">    **Constants:**</span>
<span class="sd">       * :mod:`~dpt_tools.e_lim`: Used to determine circular orbits</span>
<span class="sd">       * :mod:`~dpt_tools.i_lim`: Used to determine non-inclined orbits</span>


<span class="sd">    **Variables:**</span>
<span class="sd">       * :math:`a`: Semi-major axis</span>
<span class="sd">       * :math:`e`: Eccentricity</span>
<span class="sd">       * :math:`i`: Inclination</span>
<span class="sd">       * :math:`\omega`: Argument of perihelion</span>
<span class="sd">       * :math:`\Omega`: Longitude of ascending node</span>
<span class="sd">       * :math:`\\nu`: True anoamly</span>


<span class="sd">    :param numpy.ndarray x: Cartesian state vectors where rows 1-6 correspond to :math:`x`, :math:`y`, :math:`z`, :math:`v_x`, :math:`v_y`, :math:`v_z` and columns correspond to different objects.</span>
<span class="sd">    :param float/numpy.ndarray m: Masses of objects. If m is a numpy vector of masses, the gravitational :math:`\mu` parameter will be calculated also as a vector.</span>
<span class="sd">    :param float M_cent: Is the mass of the central massive body, default value is the mass of the sun parameter in :mod:`~dpt_tools.M_sol`</span>
<span class="sd">    :param bool radians: If true radians are used, else all angles are given in degree.</span>

<span class="sd">    :return: Keplerian orbital elements where rows 1-6 correspond to :math:`a`, :math:`e`, :math:`i`, :math:`\omega`, :math:`\Omega`, :math:`\\nu` and columns correspond to different objects.</span>
<span class="sd">    :rtype: numpy.ndarray</span>

<span class="sd">    **Example:**</span>
<span class="sd">       </span>
<span class="sd">       Convert 1 AU distance object of Earth mass traveling at 30 km/s tangential velocity to Kepler elements.</span>

<span class="sd">       .. code-block:: python</span>

<span class="sd">          import dpt_tools as dpt</span>
<span class="sd">          import numpy as n</span>
<span class="sd">          import scipy.constants as c</span>

<span class="sd">          state = n.array([</span>
<span class="sd">            c.au*1.0, #x</span>
<span class="sd">            0, #y</span>
<span class="sd">            0, #z</span>
<span class="sd">            0, #vx</span>
<span class="sd">            30e3, #vy</span>
<span class="sd">            0, #vz</span>
<span class="sd">          ], dtype=n.float)</span>

<span class="sd">          orbit = dpt.cart2kep(state, m=5.97237e24, M_cent=1.9885e30, radians=False)</span>
<span class="sd">          print(&#39;Orbit: a={} AU, e={}&#39;.format(orbit[0]/c.au, orbit[1]))</span>
<span class="sd">          print(&#39;(i, omega, Omega, nu)={} deg &#39;.format(orbit[2:]))</span>


<span class="sd">    *Reference:* Daniel Kastinen Master Thesis: Meteors and Celestial Dynamics</span>
<span class="sd">    &#39;&#39;&#39;</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;Input type </span><span class="si">{}</span><span class="s1"> not supported: must be </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span> <span class="nb">type</span><span class="p">(</span><span class="n">x</span><span class="p">),</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="p">))</span>
    <span class="k">if</span> <span class="n">x</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="mi">6</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Input data must have at least 6 variables along axis 0: input shape is </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">shape</span><span class="p">))</span>
    
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">:</span>
        <span class="n">input_is_vector</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">x</span><span class="o">.</span><span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">ValueError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Error </span><span class="si">{}</span><span class="s1"> while trying to cast vector into single column.&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Input array shape: </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">shape</span><span class="p">))</span>
            <span class="k">raise</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">input_is_vector</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="n">ez</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">x</span><span class="o">.</span><span class="n">dtype</span><span class="p">)</span>
    <span class="n">ex</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">x</span><span class="o">.</span><span class="n">dtype</span><span class="p">)</span>
    
    <span class="n">o</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">x</span><span class="o">.</span><span class="n">dtype</span><span class="p">)</span>
    <span class="n">iter_n</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

    <span class="n">r</span> <span class="o">=</span> <span class="n">x</span><span class="p">[:</span><span class="mi">3</span><span class="p">,:]</span>
    <span class="n">v</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="mi">3</span><span class="p">:,:]</span>
    <span class="n">rn</span> <span class="o">=</span> <span class="n">_np_vec_norm</span><span class="p">(</span><span class="n">r</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">vn</span> <span class="o">=</span> <span class="n">_np_vec_norm</span><span class="p">(</span><span class="n">v</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

    <span class="n">mu</span> <span class="o">=</span> <span class="n">scipy</span><span class="o">.</span><span class="n">constants</span><span class="o">.</span><span class="n">G</span><span class="o">*</span><span class="p">(</span><span class="n">m</span> <span class="o">+</span> <span class="n">M_cent</span><span class="p">)</span>

    <span class="n">vr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span> <span class="p">(</span><span class="n">r</span><span class="o">/</span><span class="n">rn</span><span class="p">)</span><span class="o">*</span><span class="n">v</span> <span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

    <span class="n">epsilon</span> <span class="o">=</span> <span class="n">vn</span><span class="o">**</span><span class="mi">2</span><span class="o">*</span><span class="mf">0.5</span> <span class="o">-</span> <span class="n">mu</span><span class="o">/</span><span class="n">rn</span>

    <span class="n">o</span><span class="p">[</span><span class="mi">0</span><span class="p">,:]</span> <span class="o">=</span> <span class="o">-</span><span class="n">mu</span><span class="o">/</span><span class="p">(</span><span class="mf">2.0</span><span class="o">*</span><span class="n">epsilon</span><span class="p">)</span>

    <span class="n">e</span> <span class="o">=</span> <span class="mf">1.0</span><span class="o">/</span><span class="n">mu</span><span class="o">*</span><span class="p">((</span><span class="n">vn</span><span class="o">**</span><span class="mi">2</span> <span class="o">-</span> <span class="n">mu</span><span class="o">/</span><span class="n">rn</span><span class="p">)</span><span class="o">*</span><span class="n">r</span> <span class="o">-</span> <span class="p">(</span><span class="n">rn</span><span class="o">*</span><span class="n">vr</span><span class="p">)</span><span class="o">*</span><span class="n">v</span><span class="p">)</span>
    <span class="n">o</span><span class="p">[</span><span class="mi">1</span><span class="p">,:]</span> <span class="o">=</span> <span class="n">_np_vec_norm</span><span class="p">(</span><span class="n">e</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

    <span class="c1">#could implement this with nditers</span>
    <span class="c1">#np.nditer(a, flags=[&#39;external_loop&#39;], order=&#39;F&#39;)</span>

    <span class="k">for</span> <span class="n">ind</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">iter_n</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">o</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">ind</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">o</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">ind</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="n">o</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">ind</span><span class="p">]</span>

        <span class="n">h</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cross</span><span class="p">(</span> <span class="n">r</span><span class="p">[:,</span> <span class="n">ind</span><span class="p">],</span> <span class="n">v</span><span class="p">[:,</span> <span class="n">ind</span><span class="p">]</span> <span class="p">)</span>
        <span class="n">hn</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">h</span><span class="p">)</span>
        <span class="n">inc</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arccos</span><span class="p">(</span><span class="n">h</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">/</span><span class="n">hn</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">inc</span> <span class="o">&lt;</span> <span class="n">i_lim</span><span class="p">:</span>
            <span class="n">n</span> <span class="o">=</span> <span class="n">ex</span>
            <span class="n">nn</span> <span class="o">=</span> <span class="mf">1.0</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">n</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cross</span><span class="p">(</span><span class="n">ez</span><span class="p">,</span> <span class="n">h</span><span class="p">)</span>
            <span class="n">nn</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">inc</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">i_lim</span><span class="p">:</span>
            <span class="n">asc_node</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="k">elif</span> <span class="n">n</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mf">0.0</span><span class="p">:</span>
            <span class="n">asc_node</span> <span class="o">=</span> <span class="mf">2.0</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">arccos</span><span class="p">(</span><span class="n">n</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">/</span><span class="n">nn</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">asc_node</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arccos</span><span class="p">(</span><span class="n">n</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">/</span><span class="n">nn</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">o</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="n">ind</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">e_lim</span><span class="p">:</span>
            <span class="n">omega</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">tmp_ratio</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">n</span><span class="o">*</span><span class="n">e</span><span class="p">[:,</span> <span class="n">ind</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">nn</span><span class="o">*</span><span class="n">o</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="n">ind</span><span class="p">])</span>
            <span class="k">if</span> <span class="n">tmp_ratio</span> <span class="o">&gt;</span> <span class="mf">1.0</span><span class="p">:</span>
                <span class="n">tmp_ratio</span> <span class="o">=</span> <span class="mf">1.0</span>
            <span class="k">elif</span> <span class="n">tmp_ratio</span> <span class="o">&lt;</span> <span class="o">-</span><span class="mf">1.0</span><span class="p">:</span>
                <span class="n">tmp_ratio</span> <span class="o">=</span> <span class="o">-</span><span class="mf">1.0</span>

            <span class="k">if</span> <span class="n">e</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span><span class="n">ind</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mf">0.0</span><span class="p">:</span>
                <span class="n">omega</span> <span class="o">=</span> <span class="mf">2.0</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">arccos</span><span class="p">(</span><span class="n">tmp_ratio</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">omega</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arccos</span><span class="p">(</span><span class="n">tmp_ratio</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">o</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="n">ind</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">e_lim</span><span class="p">:</span>
            <span class="n">tmp_ratio</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">e</span><span class="p">[:,</span><span class="n">ind</span><span class="p">]</span><span class="o">*</span><span class="n">r</span><span class="p">[:,</span><span class="n">ind</span><span class="p">],</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">o</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="n">ind</span><span class="p">]</span><span class="o">*</span><span class="n">rn</span><span class="p">[</span><span class="n">ind</span><span class="p">])</span>
            <span class="k">if</span> <span class="n">tmp_ratio</span> <span class="o">&gt;</span> <span class="mf">1.0</span><span class="p">:</span>
                <span class="n">tmp_ratio</span> <span class="o">=</span> <span class="mf">1.0</span>
            <span class="k">elif</span> <span class="n">tmp_ratio</span> <span class="o">&lt;</span> <span class="o">-</span><span class="mf">1.0</span><span class="p">:</span>
                <span class="n">tmp_ratio</span> <span class="o">=</span> <span class="o">-</span><span class="mf">1.0</span>

            <span class="k">if</span> <span class="n">vr</span><span class="p">[</span><span class="n">ind</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mf">0.0</span><span class="p">:</span>
                <span class="n">nu</span> <span class="o">=</span> <span class="mf">2.0</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">arccos</span><span class="p">(</span><span class="n">tmp_ratio</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">nu</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arccos</span><span class="p">(</span><span class="n">tmp_ratio</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">tmp_ratio</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">((</span><span class="n">n</span><span class="o">/</span><span class="n">nn</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">r</span><span class="p">[:,</span><span class="n">ind</span><span class="p">]</span><span class="o">/</span><span class="n">rn</span><span class="p">[</span><span class="n">ind</span><span class="p">]),</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">tmp_ratio</span> <span class="o">&gt;</span> <span class="mf">1.0</span><span class="p">:</span>
                <span class="n">tmp_ratio</span> <span class="o">=</span> <span class="mf">1.0</span>
            <span class="k">elif</span> <span class="n">tmp_ratio</span> <span class="o">&lt;</span> <span class="o">-</span><span class="mf">1.0</span><span class="p">:</span>
                <span class="n">tmp_ratio</span> <span class="o">=</span> <span class="o">-</span><span class="mf">1.0</span>
            <span class="n">nu</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arccos</span><span class="p">(</span><span class="n">tmp_ratio</span><span class="p">)</span>

            <span class="k">if</span> <span class="p">(</span><span class="n">r</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span><span class="n">ind</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mf">0.0</span> <span class="ow">and</span> <span class="n">inc</span> <span class="o">&gt;=</span> <span class="n">i_lim</span><span class="p">)</span> <span class="ow">or</span> \
                    <span class="p">(</span><span class="n">r</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="n">ind</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mf">0.0</span> <span class="ow">and</span> <span class="n">inc</span> <span class="o">&lt;</span> <span class="n">i_lim</span><span class="p">):</span>
                <span class="n">nu</span> <span class="o">=</span> <span class="mf">2.0</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">-</span> <span class="n">nu</span>

        <span class="n">o</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span><span class="n">ind</span><span class="p">]</span> <span class="o">=</span> <span class="n">inc</span>
        <span class="n">o</span><span class="p">[</span><span class="mi">3</span><span class="p">,</span><span class="n">ind</span><span class="p">]</span> <span class="o">=</span> <span class="n">omega</span>
        <span class="n">o</span><span class="p">[</span><span class="mi">4</span><span class="p">,</span><span class="n">ind</span><span class="p">]</span> <span class="o">=</span> <span class="n">asc_node</span>
        <span class="n">o</span><span class="p">[</span><span class="mi">5</span><span class="p">,</span><span class="n">ind</span><span class="p">]</span> <span class="o">=</span> <span class="n">nu</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">radians</span><span class="p">:</span>
        <span class="n">o</span><span class="p">[</span><span class="mi">2</span><span class="p">:,:]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">degrees</span><span class="p">(</span><span class="n">o</span><span class="p">[</span><span class="mi">2</span><span class="p">:,:])</span>

    <span class="k">if</span> <span class="n">input_is_vector</span><span class="p">:</span>
        <span class="n">x</span><span class="o">.</span><span class="n">shape</span> <span class="o">=</span> <span class="p">(</span><span class="mi">6</span><span class="p">,)</span>
        <span class="n">o</span><span class="o">.</span><span class="n">shape</span> <span class="o">=</span> <span class="p">(</span><span class="mi">6</span><span class="p">,)</span>

    <span class="k">return</span> <span class="n">o</span></div>


<div class="viewcode-block" id="true2eccentric"><a class="viewcode-back" href="../modules/dpt_tools.html#dpt_tools.true2eccentric">[docs]</a><span class="k">def</span> <span class="nf">true2eccentric</span><span class="p">(</span><span class="n">nu</span><span class="p">,</span> <span class="n">e</span><span class="p">,</span> <span class="n">radians</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Calculates the eccentric anomaly from the true anomaly.</span>

<span class="sd">    :param float/numpy.ndarray nu: True anomaly.</span>
<span class="sd">    :param float/numpy.ndarray e: Eccentricity of ellipse.</span>
<span class="sd">    :param bool radians: If true radians are used, else all angles are given in degrees</span>

<span class="sd">    :return: Eccentric anomaly.</span>
<span class="sd">    :rtype: numpy.ndarray or float</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">radians</span><span class="p">:</span>
        <span class="n">_nu</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">radians</span><span class="p">(</span><span class="n">nu</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">_nu</span> <span class="o">=</span> <span class="n">nu</span>

    <span class="n">E</span> <span class="o">=</span> <span class="mf">2.0</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">arctan</span><span class="p">(</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span> <span class="p">(</span><span class="mf">1.0</span> <span class="o">-</span> <span class="n">e</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="mf">1.0</span> <span class="o">+</span> <span class="n">e</span><span class="p">)</span> <span class="p">)</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">tan</span><span class="p">(</span><span class="n">_nu</span><span class="o">*</span><span class="mf">0.5</span><span class="p">)</span> <span class="p">)</span>
    <span class="n">E</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mod</span><span class="p">(</span><span class="n">E</span> <span class="o">+</span> <span class="mf">2.</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span><span class="mf">2.</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span>
    
    <span class="k">if</span> <span class="ow">not</span> <span class="n">radians</span><span class="p">:</span>
        <span class="n">E</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">degrees</span><span class="p">(</span><span class="n">E</span><span class="p">)</span>
    
    <span class="k">return</span> <span class="n">E</span></div>


<div class="viewcode-block" id="eccentric2true"><a class="viewcode-back" href="../modules/dpt_tools.html#dpt_tools.eccentric2true">[docs]</a><span class="k">def</span> <span class="nf">eccentric2true</span><span class="p">(</span><span class="n">E</span><span class="p">,</span> <span class="n">e</span><span class="p">,</span> <span class="n">radians</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Calculates the true anomaly from the eccentric anomaly.</span>

<span class="sd">    :param float/numpy.ndarray E: Eccentric anomaly.</span>
<span class="sd">    :param float/numpy.ndarray e: Eccentricity of ellipse.</span>
<span class="sd">    :param bool radians: If true radians are used, else all angles are given in degrees</span>

<span class="sd">    :return: True anomaly.</span>
<span class="sd">    :rtype: numpy.ndarray or float</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">radians</span><span class="p">:</span>
        <span class="n">_E</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">radians</span><span class="p">(</span><span class="n">E</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">_E</span> <span class="o">=</span> <span class="n">E</span>

    <span class="n">nu</span> <span class="o">=</span> <span class="mf">2.0</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">arctan</span><span class="p">(</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span> <span class="p">(</span><span class="mf">1.0</span> <span class="o">+</span> <span class="n">e</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="mf">1.0</span> <span class="o">-</span> <span class="n">e</span><span class="p">)</span> <span class="p">)</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">tan</span><span class="p">(</span><span class="n">_E</span><span class="o">*</span><span class="mf">0.5</span><span class="p">)</span> <span class="p">)</span>
    <span class="n">nu</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mod</span><span class="p">(</span><span class="n">nu</span> <span class="o">+</span> <span class="mf">2.</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span> <span class="mf">2.</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">radians</span><span class="p">:</span>
        <span class="n">nu</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">degrees</span><span class="p">(</span><span class="n">nu</span><span class="p">)</span>
    
    <span class="k">return</span> <span class="n">nu</span></div>


<div class="viewcode-block" id="eccentric2mean"><a class="viewcode-back" href="../modules/dpt_tools.html#dpt_tools.eccentric2mean">[docs]</a><span class="k">def</span> <span class="nf">eccentric2mean</span><span class="p">(</span><span class="n">E</span><span class="p">,</span><span class="n">e</span><span class="p">,</span><span class="n">radians</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Calculates the mean anomaly from the eccentric anomaly using Kepler equation.</span>

<span class="sd">    :param float/numpy.ndarray E: Eccentric anomaly.</span>
<span class="sd">    :param float/numpy.ndarray e: Eccentricity of ellipse.</span>
<span class="sd">    :param bool radians: If true radians are used, else all angles are given in degrees</span>

<span class="sd">    :return: Mean anomaly.</span>
<span class="sd">    :rtype: numpy.ndarray or float</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">return</span> <span class="n">E</span> <span class="o">-</span> <span class="n">e</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">E</span><span class="p">)</span></div>


<div class="viewcode-block" id="true2mean"><a class="viewcode-back" href="../modules/dpt_tools.html#dpt_tools.true2mean">[docs]</a><span class="k">def</span> <span class="nf">true2mean</span><span class="p">(</span><span class="n">nu</span><span class="p">,</span> <span class="n">e</span><span class="p">,</span> <span class="n">radians</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Transforms true anomaly to mean anomaly.</span>
<span class="sd">    </span>
<span class="sd">    **Uses:**</span>
<span class="sd">       * :func:`~dpt_tools.true2eccentric`</span>
<span class="sd">       * :func:`~dpt_tools.eccentric2mean`</span>

<span class="sd">    :param float/numpy.ndarray nu: True anomaly.</span>
<span class="sd">    :param float/numpy.ndarray e: Eccentricity of ellipse.</span>
<span class="sd">    :param bool radians: If true radians are used, else all angles are given in degrees</span>
<span class="sd">    </span>
<span class="sd">    :return: Mean anomaly.</span>
<span class="sd">    :rtype: numpy.ndarray or float</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">radians</span><span class="p">:</span>
        <span class="n">_nu</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">radians</span><span class="p">(</span><span class="n">nu</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">_nu</span> <span class="o">=</span> <span class="n">nu</span>

    <span class="n">E</span> <span class="o">=</span> <span class="n">true2eccentric</span><span class="p">(</span><span class="n">_nu</span><span class="p">,</span> <span class="n">e</span><span class="p">,</span> <span class="n">radians</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">M</span> <span class="o">=</span> <span class="n">eccentric2mean</span><span class="p">(</span><span class="n">E</span><span class="p">,</span> <span class="n">e</span><span class="p">,</span> <span class="n">radians</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    
    <span class="k">if</span> <span class="ow">not</span> <span class="n">radians</span><span class="p">:</span>
        <span class="n">M</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">degrees</span><span class="p">(</span><span class="n">M</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">M</span></div>


<div class="viewcode-block" id="elliptic_radius"><a class="viewcode-back" href="../modules/dpt_tools.html#dpt_tools.elliptic_radius">[docs]</a><span class="k">def</span> <span class="nf">elliptic_radius</span><span class="p">(</span><span class="n">E</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="n">e</span><span class="p">,</span><span class="n">radians</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Calculates the distance between the left focus point of an ellipse and a point on the ellipse defined by the eccentric anomaly.</span>

<span class="sd">    :param float/numpy.ndarray E: Eccentric anomaly.</span>
<span class="sd">    :param float/numpy.ndarray a: Semi-major axis of ellipse.</span>
<span class="sd">    :param float/numpy.ndarray e: Eccentricity of ellipse.</span>
<span class="sd">    :param bool radians: If true radians are used, else all angles are given in degrees</span>
<span class="sd">    </span>
<span class="sd">    :return: Radius from left focus point.</span>
<span class="sd">    :rtype: numpy.ndarray or float</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">radians</span><span class="p">:</span>
        <span class="n">_E</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">radians</span><span class="p">(</span><span class="n">E</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">_E</span> <span class="o">=</span> <span class="n">E</span>

    <span class="k">return</span> <span class="n">a</span><span class="o">*</span><span class="p">(</span><span class="mf">1.0</span> <span class="o">-</span> <span class="n">e</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span> <span class="n">_E</span> <span class="p">))</span></div>


<div class="viewcode-block" id="rot_mat_z"><a class="viewcode-back" href="../modules/dpt_tools.html#dpt_tools.rot_mat_z">[docs]</a><span class="k">def</span> <span class="nf">rot_mat_z</span><span class="p">(</span><span class="n">theta</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Generates the 3D transformation matrix for rotation around Z-axis.</span>
<span class="sd">    </span>
<span class="sd">    :param float theta: Angle to rotate.</span>
<span class="sd">    :param numpy.dtype dtype: The data-type of the output matrix.</span>

<span class="sd">    :return: Rotation matrix</span>
<span class="sd">    :rtype: (3,3) numpy.ndarray</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">R</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">3</span><span class="p">,</span><span class="mi">3</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">dtype</span><span class="p">)</span>
    <span class="n">R</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span>
    <span class="n">R</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span>
    <span class="n">R</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span>
    <span class="n">R</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span>
    <span class="n">R</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.0</span>
    <span class="k">return</span> <span class="n">R</span></div>


<div class="viewcode-block" id="rot_mat_x"><a class="viewcode-back" href="../modules/dpt_tools.html#dpt_tools.rot_mat_x">[docs]</a><span class="k">def</span> <span class="nf">rot_mat_x</span><span class="p">(</span><span class="n">theta</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Generates the 3D transformation matrix for rotation around X-axis.</span>
<span class="sd">    </span>
<span class="sd">    :param float theta: Angle to rotate.</span>
<span class="sd">    :param numpy.dtype dtype: The data-type of the output matrix.</span>

<span class="sd">    :return: Rotation matrix</span>
<span class="sd">    :rtype: (3,3) numpy.ndarray</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">R</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">3</span><span class="p">,</span><span class="mi">3</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">dtype</span><span class="p">)</span>
    <span class="n">R</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span>
    <span class="n">R</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span>
    <span class="n">R</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span>
    <span class="n">R</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span>
    <span class="n">R</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.0</span>
    <span class="k">return</span> <span class="n">R</span></div>


<div class="viewcode-block" id="rot_mat_y"><a class="viewcode-back" href="../modules/dpt_tools.html#dpt_tools.rot_mat_y">[docs]</a><span class="k">def</span> <span class="nf">rot_mat_y</span><span class="p">(</span><span class="n">theta</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Generates the 3D transformation matrix for rotation around Y-axis.</span>
<span class="sd">    </span>
<span class="sd">    :param float theta: Angle to rotate.</span>
<span class="sd">    :param numpy.dtype dtype: The data-type of the output matrix.</span>

<span class="sd">    :return: Rotation matrix</span>
<span class="sd">    :rtype: (3,3) numpy.ndarray</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">R</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">3</span><span class="p">,</span><span class="mi">3</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">dtype</span><span class="p">)</span>
    <span class="n">R</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span>
    <span class="n">R</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span>
    <span class="n">R</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span>
    <span class="n">R</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span>
    <span class="n">R</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.0</span>
    <span class="k">return</span> <span class="n">R</span></div>

<span class="c1"># Leapseconds code from gdar by Norut/NORCE</span>
<span class="c1"># Contributed by Tom Grydeland &lt;tgry@norceresearch.no&gt;</span>

<span class="n">sec</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">timedelta64</span><span class="p">(</span><span class="mi">1000000000</span><span class="p">,</span> <span class="s1">&#39;ns&#39;</span><span class="p">)</span>
<span class="sd">&#39;&#39;&#39;numpy.datetime64: Interval of 1 second</span>
<span class="sd">&#39;&#39;&#39;</span>


<span class="n">gps0_tai</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">datetime64</span><span class="p">(</span><span class="s1">&#39;1980-01-06 00:00:19&#39;</span><span class="p">)</span>
<span class="sd">&#39;&#39;&#39;numpy.datetime64: Epoch of GPS time, in TAI</span>
<span class="sd">&#39;&#39;&#39;</span>


<span class="n">leapseconds</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span>
    <span class="s1">&#39;1972-01-01T00:00:00&#39;</span><span class="p">,</span>
    <span class="s1">&#39;1972-07-01T00:00:00&#39;</span><span class="p">,</span>
    <span class="s1">&#39;1973-01-01T00:00:00&#39;</span><span class="p">,</span>
    <span class="s1">&#39;1974-01-01T00:00:00&#39;</span><span class="p">,</span>
    <span class="s1">&#39;1975-01-01T00:00:00&#39;</span><span class="p">,</span>
    <span class="s1">&#39;1976-01-01T00:00:00&#39;</span><span class="p">,</span>
    <span class="s1">&#39;1977-01-01T00:00:00&#39;</span><span class="p">,</span>
    <span class="s1">&#39;1978-01-01T00:00:00&#39;</span><span class="p">,</span>
    <span class="s1">&#39;1979-01-01T00:00:00&#39;</span><span class="p">,</span>
    <span class="s1">&#39;1980-01-01T00:00:00&#39;</span><span class="p">,</span>
    <span class="s1">&#39;1981-07-01T00:00:00&#39;</span><span class="p">,</span>
    <span class="s1">&#39;1982-07-01T00:00:00&#39;</span><span class="p">,</span>
    <span class="s1">&#39;1983-07-01T00:00:00&#39;</span><span class="p">,</span>
    <span class="s1">&#39;1985-07-01T00:00:00&#39;</span><span class="p">,</span>
    <span class="s1">&#39;1988-01-01T00:00:00&#39;</span><span class="p">,</span>
    <span class="s1">&#39;1990-01-01T00:00:00&#39;</span><span class="p">,</span>
    <span class="s1">&#39;1991-01-01T00:00:00&#39;</span><span class="p">,</span>
    <span class="s1">&#39;1992-07-01T00:00:00&#39;</span><span class="p">,</span>
    <span class="s1">&#39;1993-07-01T00:00:00&#39;</span><span class="p">,</span>
    <span class="s1">&#39;1994-07-01T00:00:00&#39;</span><span class="p">,</span>
    <span class="s1">&#39;1996-01-01T00:00:00&#39;</span><span class="p">,</span>
    <span class="s1">&#39;1997-07-01T00:00:00&#39;</span><span class="p">,</span>
    <span class="s1">&#39;1999-01-01T00:00:00&#39;</span><span class="p">,</span>
    <span class="s1">&#39;2006-01-01T00:00:00&#39;</span><span class="p">,</span>
    <span class="s1">&#39;2009-01-01T00:00:00&#39;</span><span class="p">,</span>
    <span class="s1">&#39;2012-07-01T00:00:00&#39;</span><span class="p">,</span>
    <span class="s1">&#39;2015-07-01T00:00:00&#39;</span><span class="p">,</span>
    <span class="s1">&#39;2017-01-01T00:00:00&#39;</span><span class="p">,</span>
<span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;M8[ns]&#39;</span><span class="p">)</span>
<span class="sd">&#39;&#39;&#39;numpy.ndarray: Leapseconds added since 1972. </span>

<span class="sd">Must be maintained manually.</span>

<span class="sd">*Source:* `tai-utc &lt;ftp://maia.usno.navy.mil/ser7/tai-utc.dat&gt;`_</span>
<span class="sd">&#39;&#39;&#39;</span>


<div class="viewcode-block" id="leapseconds_before"><a class="viewcode-back" href="../modules/dpt_tools.html#dpt_tools.leapseconds_before">[docs]</a><span class="k">def</span> <span class="nf">leapseconds_before</span><span class="p">(</span><span class="n">ytime</span><span class="p">,</span> <span class="n">tai</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Calculate the number of leapseconds has been added before given date.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">leaps</span> <span class="o">=</span> <span class="n">leapseconds_tai</span> <span class="k">if</span> <span class="n">tai</span> <span class="k">else</span> <span class="n">leapseconds</span>

    <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">isscalar</span><span class="p">(</span><span class="n">ytime</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">leaps</span> <span class="o">&lt;=</span> <span class="n">ytime</span><span class="p">)</span> <span class="o">+</span> <span class="mi">9</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">rval</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">leaps</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">,</span> <span class="p">:]</span> <span class="o">&lt;=</span> <span class="n">ytime</span><span class="o">.</span><span class="n">ravel</span><span class="p">()[</span><span class="o">...</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">],</span> <span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="mi">9</span>
        <span class="n">rval</span><span class="o">.</span><span class="n">shape</span> <span class="o">=</span> <span class="n">ytime</span><span class="o">.</span><span class="n">shape</span>
        <span class="k">return</span> <span class="n">rval</span></div>


<div class="viewcode-block" id="tai2utc"><a class="viewcode-back" href="../modules/dpt_tools.html#dpt_tools.tai2utc">[docs]</a><span class="k">def</span> <span class="nf">tai2utc</span><span class="p">(</span><span class="n">ytime</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;TAI to UTC conversion using Leapseconds data.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">return</span> <span class="n">ytime</span> <span class="o">-</span> <span class="n">leapseconds_before</span><span class="p">(</span><span class="n">ytime</span><span class="p">,</span> <span class="n">tai</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">*</span><span class="n">sec</span></div>

<div class="viewcode-block" id="utc2tai"><a class="viewcode-back" href="../modules/dpt_tools.html#dpt_tools.utc2tai">[docs]</a><span class="k">def</span> <span class="nf">utc2tai</span><span class="p">(</span><span class="n">ytime</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;UTC to TAI conversion using Leapseconds data.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">return</span> <span class="n">ytime</span> <span class="o">+</span> <span class="n">leapseconds_before</span><span class="p">(</span><span class="n">ytime</span><span class="p">)</span><span class="o">*</span><span class="n">sec</span></div>

<span class="c1"># This can only be initialized after utc2tai has been defined.</span>
<span class="n">leapseconds_tai</span> <span class="o">=</span> <span class="n">utc2tai</span><span class="p">(</span><span class="n">leapseconds</span><span class="p">)</span>


<div class="viewcode-block" id="laguerre_solve_kepler"><a class="viewcode-back" href="../modules/dpt_tools.html#dpt_tools.laguerre_solve_kepler">[docs]</a><span class="k">def</span> <span class="nf">laguerre_solve_kepler</span><span class="p">(</span><span class="n">E0</span><span class="p">,</span> <span class="n">M</span><span class="p">,</span> <span class="n">e</span><span class="p">,</span> <span class="n">tol</span><span class="o">=</span><span class="mf">1e-12</span><span class="p">,</span> <span class="n">degree</span><span class="o">=</span><span class="mi">5</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Solve the Kepler equation using the The Laguerre Algorithm, a algorithm that guarantees global convergence.</span>
<span class="sd">    Adjusted for solving only real roots (non-hyperbolic orbits)</span>
<span class="sd">    </span>
<span class="sd">    Absolute numerical tolerance is defined as :math:`|f(E)| &lt; tol` where :math:`f(E) = M - E + e \sin(E)`.</span>

<span class="sd">    # TODO: implement hyperbolic solving.</span>

<span class="sd">    *Note:* Choice of polynomial degree does not matter significantly for convergence rate.</span>

<span class="sd">    :param float M: Initial guess for eccentric anomaly.</span>
<span class="sd">    :param float M: Mean anomaly.</span>
<span class="sd">    :param float e: Eccentricity of ellipse.</span>
<span class="sd">    :param float tol: Absolute numerical tolerance eccentric anomaly.</span>
<span class="sd">    :param int degree: Polynomial degree in derivation of Laguerre Algorithm.</span>
<span class="sd">    :return: Eccentric anomaly and number of iterations.</span>
<span class="sd">    :rtype: tuple of (float, int)</span>

<span class="sd">    *Reference:* Conway, B. A. (1986). An improved algorithm due to Laguerre for the solution of Kepler&#39;s equation. Celestial mechanics, 39(2), 199-211.</span>

<span class="sd">    **Example:**</span>

<span class="sd">    .. code-block:: python</span>

<span class="sd">       import dpt_tools as dpt</span>
<span class="sd">       M = 3.14</span>
<span class="sd">       e = 0.8</span>
<span class="sd">       </span>
<span class="sd">       #Use mean anomaly as initial guess</span>
<span class="sd">       E, iterations = dpt.laguerre_solve_kepler(</span>
<span class="sd">          E0 = M,</span>
<span class="sd">          M = M,</span>
<span class="sd">          e = e,</span>
<span class="sd">          tol = 1e-12,</span>
<span class="sd">       )</span>
<span class="sd">    &#39;&#39;&#39;</span>

    <span class="n">degree</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">degree</span><span class="p">)</span>

    <span class="n">_f</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">E</span><span class="p">:</span> <span class="n">M</span> <span class="o">-</span> <span class="n">E</span> <span class="o">+</span> <span class="n">e</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">E</span><span class="p">)</span>
    <span class="n">_fp</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">E</span><span class="p">:</span> <span class="n">e</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">E</span><span class="p">)</span> <span class="o">-</span> <span class="mf">1.0</span>
    <span class="n">_fpp</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">E</span><span class="p">:</span> <span class="o">-</span><span class="n">e</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">E</span><span class="p">)</span>

    <span class="n">E</span> <span class="o">=</span> <span class="n">E0</span>

    <span class="n">f_eval</span> <span class="o">=</span> <span class="n">_f</span><span class="p">(</span><span class="n">E</span><span class="p">)</span>

    <span class="n">it_num</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="k">while</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">f_eval</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="n">tol</span><span class="p">:</span>
        <span class="n">it_num</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="c1">#sqrt_term = np.sqrt(</span>
        <span class="c1">#    ((degree - 1.0)*fp(E))**2</span>
        <span class="c1">#    - degree*(degree - 1)*f(E)*fpp(E)</span>
        <span class="c1">#)</span>

        <span class="n">fp_eval</span> <span class="o">=</span> <span class="n">_fp</span><span class="p">(</span><span class="n">E</span><span class="p">)</span>

        <span class="n">sqrt_term</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span>
            <span class="p">(</span><span class="n">degree</span> <span class="o">-</span> <span class="mf">1.0</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="o">*</span><span class="n">fp_eval</span><span class="o">**</span><span class="mi">2</span>
            <span class="o">-</span> <span class="n">degree</span><span class="o">*</span><span class="p">(</span><span class="n">degree</span> <span class="o">-</span> <span class="mf">1.0</span><span class="p">)</span><span class="o">*</span><span class="n">f_eval</span><span class="o">*</span><span class="n">_fpp</span><span class="p">(</span><span class="n">E</span><span class="p">)</span>
        <span class="p">))</span>

        <span class="n">denom_p</span> <span class="o">=</span> <span class="n">fp_eval</span> <span class="o">+</span> <span class="n">sqrt_term</span>
        <span class="n">denom_m</span> <span class="o">=</span> <span class="n">fp_eval</span> <span class="o">-</span> <span class="n">sqrt_term</span>

        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">denom_p</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">denom_m</span><span class="p">):</span>
            <span class="n">delta</span> <span class="o">=</span> <span class="n">degree</span><span class="o">*</span><span class="n">f_eval</span><span class="o">/</span><span class="n">denom_p</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">delta</span> <span class="o">=</span> <span class="n">degree</span><span class="o">*</span><span class="n">f_eval</span><span class="o">/</span><span class="n">denom_m</span>

        <span class="n">E</span> <span class="o">=</span> <span class="n">E</span> <span class="o">-</span> <span class="n">delta</span>

        <span class="n">f_eval</span> <span class="o">=</span> <span class="n">_f</span><span class="p">(</span><span class="n">E</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">E</span><span class="p">,</span> <span class="n">it_num</span></div>


<span class="k">def</span> <span class="nf">_get_kepler_guess</span><span class="p">(</span><span class="n">M</span><span class="p">,</span> <span class="n">e</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;The different initial guesses for solving the Kepler equation based on input mean anomaly</span>
<span class="sd">    </span>
<span class="sd">    :param float M: Mean anomaly.</span>
<span class="sd">    :param float e: Eccentricity of ellipse.</span>
<span class="sd">    :return: Guess for eccentric anomaly.</span>
<span class="sd">    :rtype: float</span>

<span class="sd">    Reference: Esmaelzadeh, R., &amp; Ghadiri, H. (2014). Appropriate starter for solving the Kepler&#39;s equation. International Journal of Computer Applications, 89(7).</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">if</span> <span class="n">M</span> <span class="o">&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">:</span>
        <span class="n">_M</span> <span class="o">=</span> <span class="mf">2.0</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">-</span> <span class="n">M</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">_M</span> <span class="o">=</span> <span class="n">M</span>

    <span class="k">if</span> <span class="n">_M</span> <span class="o">&lt;</span> <span class="mf">0.25</span><span class="p">:</span>
        <span class="n">E0</span> <span class="o">=</span> <span class="n">_M</span> <span class="o">+</span> <span class="n">e</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">_M</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="mf">1.0</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">_M</span> <span class="o">+</span> <span class="n">e</span><span class="p">)</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">_M</span><span class="p">))</span>
    <span class="k">elif</span> <span class="n">_M</span> <span class="o">&lt;</span> <span class="mf">2.0</span><span class="p">:</span>
        <span class="n">E0</span> <span class="o">=</span> <span class="n">_M</span> <span class="o">+</span> <span class="n">e</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">E0</span> <span class="o">=</span> <span class="n">_M</span> <span class="o">+</span> <span class="p">(</span><span class="n">e</span><span class="o">*</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">-</span> <span class="n">_M</span><span class="p">))</span><span class="o">/</span><span class="p">(</span><span class="mf">1.0</span> <span class="o">+</span> <span class="n">e</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">M</span> <span class="o">&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">:</span>
        <span class="n">E0</span> <span class="o">=</span> <span class="mf">2.0</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">-</span> <span class="n">E0</span>

    <span class="k">return</span> <span class="n">E0</span>


<div class="viewcode-block" id="kepler_guess"><a class="viewcode-back" href="../modules/dpt_tools.html#dpt_tools.kepler_guess">[docs]</a><span class="k">def</span> <span class="nf">kepler_guess</span><span class="p">(</span><span class="n">M</span><span class="p">,</span> <span class="n">e</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Guess the initial iteration point for newtons method.</span>
<span class="sd">    </span>
<span class="sd">    :param float/numpy.ndarray M: Mean anomaly.</span>
<span class="sd">    :param float/numpy.ndarray e: Eccentricity of ellipse.</span>
<span class="sd">    :return: Guess for eccentric anomaly.</span>
<span class="sd">    :rtype: numpy.ndarray or float</span>

<span class="sd">    *Reference:* Esmaelzadeh, R., &amp; Ghadiri, H. (2014). Appropriate starter for solving the Kepler&#39;s equation. International Journal of Computer Applications, 89(7).</span>
<span class="sd">    &#39;&#39;&#39;</span>

    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">M</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)</span> <span class="ow">or</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">M</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
            <span class="n">M</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">e</span><span class="o">.</span><span class="n">dtype</span><span class="p">)</span><span class="o">*</span><span class="n">M</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
            <span class="n">e</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">M</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">M</span><span class="o">.</span><span class="n">dtype</span><span class="p">)</span><span class="o">*</span><span class="n">e</span>
        <span class="k">if</span> <span class="n">M</span><span class="o">.</span><span class="n">shape</span> <span class="o">!=</span> <span class="n">e</span><span class="o">.</span><span class="n">shape</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;Input dimensions does not agree&#39;</span><span class="p">)</span>

        <span class="n">E0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="n">M</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">M</span><span class="o">.</span><span class="n">dtype</span><span class="p">)</span>

        <span class="n">out_it</span> <span class="o">=</span> <span class="n">E0</span><span class="o">.</span><span class="n">size</span>
        <span class="n">Mit</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nditer</span><span class="p">(</span><span class="n">M</span><span class="p">)</span>
        <span class="n">eit</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nditer</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
        <span class="n">Eit</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nditer</span><span class="p">(</span><span class="n">E0</span><span class="p">,</span> <span class="n">op_flags</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;readwrite&#39;</span><span class="p">])</span>

        <span class="k">for</span> <span class="n">it</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">out_it</span><span class="p">):</span>
            <span class="n">Mc</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="n">Mit</span><span class="p">)</span>
            <span class="n">ec</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="n">eit</span><span class="p">)</span>
            <span class="n">Ec</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="n">Eit</span><span class="p">)</span>

            <span class="n">E_calc</span> <span class="o">=</span> <span class="n">_get_kepler_guess</span><span class="p">(</span><span class="n">Mc</span><span class="p">,</span> <span class="n">ec</span><span class="p">)</span>

            <span class="n">Ec</span><span class="p">[</span><span class="o">...</span><span class="p">]</span> <span class="o">=</span> <span class="n">E_calc</span>

    <span class="k">else</span><span class="p">:</span>
        <span class="n">E0</span> <span class="o">=</span> <span class="n">_get_kepler_guess</span><span class="p">(</span><span class="n">M</span><span class="p">,</span> <span class="n">e</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">E0</span></div>


<div class="viewcode-block" id="mean2eccentric"><a class="viewcode-back" href="../modules/dpt_tools.html#dpt_tools.mean2eccentric">[docs]</a><span class="k">def</span> <span class="nf">mean2eccentric</span><span class="p">(</span><span class="n">M</span><span class="p">,</span> <span class="n">e</span><span class="p">,</span> <span class="n">tol</span><span class="o">=</span><span class="mf">1e-12</span><span class="p">,</span> <span class="n">radians</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Calculates the eccentric anomaly from the mean anomaly by solving the Kepler equation.</span>

<span class="sd">    :param float/numpy.ndarray M: Mean anomaly.</span>
<span class="sd">    :param float/numpy.ndarray e: Eccentricity of ellipse.</span>
<span class="sd">    :param float tol: Numerical tolerance for solving Keplers equation in units of radians.</span>
<span class="sd">    :param bool radians: If true radians are used, else all angles are given in degrees</span>
<span class="sd">    </span>
<span class="sd">    :return: True anomaly.</span>
<span class="sd">    :rtype: numpy.ndarray or float</span>

<span class="sd">    **Uses:**</span>
<span class="sd">       * :func:`~dpt_tools._get_kepler_guess`</span>
<span class="sd">       * :func:`~dpt_tools.laguerre_solve_kepler`</span>
<span class="sd">    &#39;&#39;&#39;</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">radians</span><span class="p">:</span>
        <span class="n">_M</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">radians</span><span class="p">(</span><span class="n">M</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">_M</span> <span class="o">=</span> <span class="n">M</span>

    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">_M</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)</span> <span class="ow">or</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">_M</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
            <span class="n">_M</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">e</span><span class="o">.</span><span class="n">dtype</span><span class="p">)</span><span class="o">*</span><span class="n">_M</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
            <span class="n">e</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">_M</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">_M</span><span class="o">.</span><span class="n">dtype</span><span class="p">)</span><span class="o">*</span><span class="n">e</span>
        <span class="k">if</span> <span class="n">_M</span><span class="o">.</span><span class="n">shape</span> <span class="o">!=</span> <span class="n">e</span><span class="o">.</span><span class="n">shape</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;Input dimensions does not agree&#39;</span><span class="p">)</span>


        <span class="n">E</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="n">_M</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">_M</span><span class="o">.</span><span class="n">dtype</span><span class="p">)</span>

        <span class="n">out_it</span> <span class="o">=</span> <span class="n">E</span><span class="o">.</span><span class="n">size</span>
        <span class="n">Mit</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nditer</span><span class="p">(</span><span class="n">_M</span><span class="p">)</span>
        <span class="n">eit</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nditer</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
        <span class="n">Eit</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nditer</span><span class="p">(</span><span class="n">E</span><span class="p">,</span> <span class="n">op_flags</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;readwrite&#39;</span><span class="p">])</span>

        <span class="k">for</span> <span class="n">it</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">out_it</span><span class="p">):</span>
            <span class="n">Mc</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="n">Mit</span><span class="p">)</span>
            <span class="n">ec</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="n">eit</span><span class="p">)</span>
            <span class="n">Ec</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="n">Eit</span><span class="p">)</span>

            <span class="n">E0</span> <span class="o">=</span> <span class="n">_get_kepler_guess</span><span class="p">(</span><span class="n">Mc</span><span class="p">,</span> <span class="n">ec</span><span class="p">)</span>
            <span class="n">E_calc</span><span class="p">,</span> <span class="n">it_num</span> <span class="o">=</span> <span class="n">laguerre_solve_kepler</span><span class="p">(</span><span class="n">E0</span><span class="p">,</span> <span class="n">Mc</span><span class="p">,</span> <span class="n">ec</span><span class="p">,</span> <span class="n">tol</span><span class="o">=</span><span class="n">tol</span><span class="p">)</span>

            <span class="n">Ec</span><span class="p">[</span><span class="o">...</span><span class="p">]</span> <span class="o">=</span> <span class="n">E_calc</span>

    <span class="k">else</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">e</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">M</span>

        <span class="n">E0</span> <span class="o">=</span> <span class="n">_get_kepler_guess</span><span class="p">(</span><span class="n">_M</span><span class="p">,</span> <span class="n">e</span><span class="p">)</span>
        <span class="n">E</span><span class="p">,</span> <span class="n">it_num</span> <span class="o">=</span> <span class="n">laguerre_solve_kepler</span><span class="p">(</span><span class="n">E0</span><span class="p">,</span> <span class="n">_M</span><span class="p">,</span> <span class="n">e</span><span class="p">,</span> <span class="n">tol</span><span class="o">=</span><span class="n">tol</span><span class="p">)</span>


    <span class="k">if</span> <span class="ow">not</span> <span class="n">radians</span><span class="p">:</span>
        <span class="n">E</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">degrees</span><span class="p">(</span><span class="n">E</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">E</span></div>


<div class="viewcode-block" id="mean2true"><a class="viewcode-back" href="../modules/dpt_tools.html#dpt_tools.mean2true">[docs]</a><span class="k">def</span> <span class="nf">mean2true</span><span class="p">(</span><span class="n">M</span><span class="p">,</span> <span class="n">e</span><span class="p">,</span> <span class="n">tol</span><span class="o">=</span><span class="mf">1e-12</span><span class="p">,</span> <span class="n">radians</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Transforms mean anomaly to true anomaly.</span>
<span class="sd">    </span>
<span class="sd">    **Uses:**</span>
<span class="sd">       * :func:`~dpt_tools.mean2eccentric`</span>
<span class="sd">       * :func:`~dpt_tools.eccentric2true`</span>

<span class="sd">    :param float/numpy.ndarray M: Mean anomaly.</span>
<span class="sd">    :param float/numpy.ndarray e: Eccentricity of ellipse.</span>
<span class="sd">    :param float tol: Numerical tolerance for solving Keplers equation in units of radians.</span>
<span class="sd">    :param bool radians: If true radians are used, else all angles are given in degrees</span>
<span class="sd">    </span>
<span class="sd">    :return: True anomaly.</span>
<span class="sd">    :rtype: numpy.ndarray or float</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">radians</span><span class="p">:</span>
        <span class="n">_M</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">radians</span><span class="p">(</span><span class="n">M</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">_M</span> <span class="o">=</span> <span class="n">M</span>

    <span class="n">E</span> <span class="o">=</span> <span class="n">mean2eccentric</span><span class="p">(</span><span class="n">_M</span><span class="p">,</span> <span class="n">e</span><span class="p">,</span> <span class="n">tol</span><span class="o">=</span><span class="n">tol</span><span class="p">,</span> <span class="n">radians</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">nu</span> <span class="o">=</span> <span class="n">eccentric2true</span><span class="p">(</span><span class="n">E</span><span class="p">,</span> <span class="n">e</span><span class="p">,</span> <span class="n">radians</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">radians</span><span class="p">:</span>
        <span class="n">nu</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">degrees</span><span class="p">(</span><span class="n">nu</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">nu</span></div>


<div class="viewcode-block" id="orbital_speed"><a class="viewcode-back" href="../modules/dpt_tools.html#dpt_tools.orbital_speed">[docs]</a><span class="k">def</span> <span class="nf">orbital_speed</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">mu</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Calculates the orbital speed at a given radius for an Keplerian orbit :math:`v = \sqrt{\mu \left (\\frac{2}{r} - \\frac{1}{a} \\right )}`.</span>
<span class="sd">    </span>
<span class="sd">    :param float/numpy.ndarray r: Radius from the pericenter.</span>
<span class="sd">    :param float/numpy.ndarray a: Semi-major axis of ellipse.</span>
<span class="sd">    :param float mu: Standard gravitation parameter :math:`\mu = G(m_1 + m_2)` of the orbit.</span>
<span class="sd">    :return: Orbital speed.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">mu</span><span class="o">*</span><span class="p">(</span><span class="mf">2.0</span><span class="o">/</span><span class="n">r</span> <span class="o">-</span> <span class="mf">1.0</span><span class="o">/</span><span class="n">a</span><span class="p">))</span></div>


<div class="viewcode-block" id="orbital_period"><a class="viewcode-back" href="../modules/dpt_tools.html#dpt_tools.orbital_period">[docs]</a><span class="k">def</span> <span class="nf">orbital_period</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">mu</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Calculates the orbital period of an Keplerian orbit :math:`v = 2\pi\sqrt{\\frac{a^3}{\mu}}`.</span>
<span class="sd">    </span>
<span class="sd">    :param float/numpy.ndarray a: Semi-major axis of ellipse.</span>
<span class="sd">    :param float mu: Standard gravitation parameter :math:`\mu = G(m_1 + m_2)` of the orbit.</span>
<span class="sd">    :return: Orbital period.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">return</span> <span class="mf">2.0</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">a</span><span class="o">**</span><span class="mf">3.0</span><span class="o">/</span><span class="n">mu</span><span class="p">)</span></div>


<div class="viewcode-block" id="kep2cart"><a class="viewcode-back" href="../modules/dpt_tools.html#dpt_tools.kep2cart">[docs]</a><span class="k">def</span> <span class="nf">kep2cart</span><span class="p">(</span><span class="n">o</span><span class="p">,</span> <span class="n">m</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">M_cent</span><span class="o">=</span><span class="n">M_sol</span><span class="p">,</span> <span class="n">radians</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Converts set of Keplerian orbital elements to set of Cartesian state vectors.</span>
<span class="sd">    </span>
<span class="sd">    **Units:**</span>
<span class="sd">       All units are SI-units: `SI Units &lt;https://www.nist.gov/pml/weights-and-measures/metric-si/si-units&gt;`_</span>

<span class="sd">       Angles are by default given as radians, all angles are radians internally in functions, input and output angles can be both radians and degrees depending on the :code:`radians` boolean.</span>

<span class="sd">       To use custom units, simply change the definition of :code:`mu = scipy.constants.G*(m + M_cent)` to an input parameter for the function as this is the only unit dependent calculation.</span>

<span class="sd">    **Orientation of the ellipse in the coordinate system:**</span>
<span class="sd">       * For zero inclination :math:`i`: the ellipse is located in the x-y plane.</span>
<span class="sd">       * The direction of motion as True anoamly :math:`\\nu`: increases for a zero inclination :math:`i`: orbit is anti-coockwise, i.e. from +x towards +y.</span>
<span class="sd">       * If the eccentricity :math:`e`: is increased, the periapsis will lie in +x direction.</span>
<span class="sd">       * If the inclination :math:`i`: is increased, the ellipse will rotate around the x-axis, so that +y is rotated toward +z.</span>
<span class="sd">       * An increase in Longitude of ascending node :math:`\Omega`: corresponds to a rotation around the z-axis so that +x is rotated toward +y.</span>
<span class="sd">       * Changing argument of perihelion :math:`\omega`: will not change the plane of the orbit, it will rotate the orbit in the plane.</span>
<span class="sd">       * The periapsis is shifted in the direction of motion.</span>

<span class="sd">       *Reference:* &quot;Orbital Motion&quot; by A.E. Roy.</span>

<span class="sd">    **Variables:**</span>
<span class="sd">       * :math:`a`: Semi-major axis</span>
<span class="sd">       * :math:`e`: Eccentricity</span>
<span class="sd">       * :math:`i`: Inclination</span>
<span class="sd">       * :math:`\omega`: Argument of perihelion</span>
<span class="sd">       * :math:`\Omega`: Longitude of ascending node</span>
<span class="sd">       * :math:`\\nu`: True anoamly</span>

<span class="sd">    **Uses:**</span>
<span class="sd">       * :func:`~dpt_tools.true2eccentric`</span>
<span class="sd">       * :func:`~dpt_tools.elliptic_radius`</span>

<span class="sd">    :param numpy.ndarray o: Keplerian orbital elements where rows 1-6 correspond to :math:`a`, :math:`e`, :math:`i`, :math:`\omega`, :math:`\Omega`, :math:`\\nu` and columns correspond to different objects.</span>
<span class="sd">    :param float/numpy.ndarray m: Masses of objects. If m is a numpy vector of masses, the gravitational :math:`\mu` parameter will be calculated also as a vector.</span>
<span class="sd">    :param float M_cent: Is the mass of the central massive body, default value is the mass of the sun parameter in :mod:`~dpt_tools.M_sol`</span>
<span class="sd">    :param bool radians: If true radians are used, else all angles are given in degree.</span>

<span class="sd">    :return: Cartesian state vectors where rows 1-6 correspond to :math:`x`, :math:`y`, :math:`z`, :math:`v_x`, :math:`v_y`, :math:`v_z` and columns correspond to different objects.</span>
<span class="sd">    :rtype: numpy.ndarray</span>

<span class="sd">    **Example:**</span>
<span class="sd">       </span>
<span class="sd">       Convert Earth J2000.0 orbital parameters to Cartesian position.</span>

<span class="sd">       .. code-block:: python</span>

<span class="sd">          import dpt_tools as dpt</span>
<span class="sd">          import numpy as n</span>
<span class="sd">          import scipy.constants as c</span>

<span class="sd">          #Periapsis approx 3 Jan</span>
<span class="sd">          orbit = n.array([</span>
<span class="sd">            c.au*1.000001018, #a</span>
<span class="sd">            0.0167086, #e</span>
<span class="sd">            7.155, #i</span>
<span class="sd">            288.1, #omega</span>
<span class="sd">            174.9, #Omega</span>
<span class="sd">            0.0, #nu</span>
<span class="sd">          ], dtype=n.float)</span>

<span class="sd">          state = dpt.kep2cart(orbit, m=5.97237e24, M_cent=1.9885e30, radians=False)</span>
<span class="sd">          print(&#39;Position: {} AU &#39;.format(state[:3]/c.au))</span>
<span class="sd">          print(&#39;Velocity: {} km/s &#39;.format(state[3:]/1e3))</span>


<span class="sd">    *Reference:* Daniel Kastinen Master Thesis: Meteors and Celestial Dynamics, &quot;Orbital Motion&quot; by A.E. Roy.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">o</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;Input type </span><span class="si">{}</span><span class="s1"> not supported: must be </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span> <span class="nb">type</span><span class="p">(</span><span class="n">o</span><span class="p">),</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="p">))</span>
    <span class="k">if</span> <span class="n">o</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="mi">6</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Input data must have at least 6 variables along axis 0: input shape is </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">o</span><span class="o">.</span><span class="n">shape</span><span class="p">))</span>
    
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">o</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">:</span>
        <span class="n">input_is_vector</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">o</span><span class="o">.</span><span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">ValueError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Error </span><span class="si">{}</span><span class="s1"> while trying to cast vector into single column.&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Input array shape: </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">o</span><span class="o">.</span><span class="n">shape</span><span class="p">))</span>
            <span class="k">raise</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">input_is_vector</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="n">mu</span> <span class="o">=</span> <span class="n">scipy</span><span class="o">.</span><span class="n">constants</span><span class="o">.</span><span class="n">G</span><span class="o">*</span><span class="p">(</span><span class="n">m</span> <span class="o">+</span> <span class="n">M_cent</span><span class="p">)</span>

    <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="n">o</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">o</span><span class="o">.</span><span class="n">dtype</span><span class="p">)</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">radians</span><span class="p">:</span>
        <span class="n">o</span><span class="p">[</span><span class="mi">2</span><span class="p">:,:]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">radians</span><span class="p">(</span><span class="n">o</span><span class="p">[</span><span class="mi">2</span><span class="p">:,:])</span>

    <span class="n">nu</span> <span class="o">=</span> <span class="n">o</span><span class="p">[</span><span class="mi">5</span><span class="p">,:]</span>
    <span class="n">omega</span> <span class="o">=</span> <span class="n">o</span><span class="p">[</span><span class="mi">3</span><span class="p">,:]</span>
    <span class="n">asc_node</span> <span class="o">=</span> <span class="n">o</span><span class="p">[</span><span class="mi">4</span><span class="p">,:]</span>
    <span class="n">inc</span> <span class="o">=</span> <span class="n">o</span><span class="p">[</span><span class="mi">2</span><span class="p">,:]</span>
    <span class="n">wf</span> <span class="o">=</span> <span class="n">nu</span> <span class="o">+</span> <span class="n">omega</span>
    <span class="n">e</span> <span class="o">=</span> <span class="n">o</span><span class="p">[</span><span class="mi">1</span><span class="p">,:]</span>
    <span class="n">a</span> <span class="o">=</span> <span class="n">o</span><span class="p">[</span><span class="mi">0</span><span class="p">,:]</span>

    <span class="n">Ecc</span> <span class="o">=</span> <span class="n">true2eccentric</span><span class="p">(</span><span class="n">nu</span><span class="p">,</span><span class="n">e</span><span class="p">,</span><span class="n">radians</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="n">rn</span> <span class="o">=</span> <span class="n">elliptic_radius</span><span class="p">(</span><span class="n">Ecc</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="n">e</span><span class="p">,</span><span class="n">radians</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="n">r</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span> <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="n">o</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">o</span><span class="o">.</span><span class="n">dtype</span> <span class="p">)</span>
    <span class="n">r</span><span class="p">[</span><span class="mi">0</span><span class="p">,:]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">wf</span><span class="p">)</span>
    <span class="n">r</span><span class="p">[</span><span class="mi">1</span><span class="p">,:]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">wf</span><span class="p">)</span>
    <span class="n">r</span> <span class="o">=</span> <span class="n">rn</span><span class="o">*</span><span class="n">r</span>

    <span class="n">cos_Omega</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">asc_node</span><span class="p">)</span>
    <span class="n">sin_Omega</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">asc_node</span><span class="p">)</span>
    <span class="n">cos_i</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">inc</span><span class="p">)</span>
    <span class="n">sin_i</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">inc</span><span class="p">)</span>
    <span class="n">cos_w</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">omega</span><span class="p">)</span>
    <span class="n">sin_w</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">omega</span><span class="p">)</span>

    <span class="c1">#order is important not to change varaibles before they are used</span>
    <span class="n">x_tmp</span> <span class="o">=</span> <span class="n">r</span><span class="p">[</span><span class="mi">0</span><span class="p">,:]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="n">r</span><span class="p">[</span><span class="mi">2</span><span class="p">,:]</span> <span class="o">=</span> <span class="n">r</span><span class="p">[</span><span class="mi">1</span><span class="p">,:]</span><span class="o">*</span><span class="n">sin_i</span>
    <span class="n">r</span><span class="p">[</span><span class="mi">0</span><span class="p">,:]</span> <span class="o">=</span> <span class="n">cos_Omega</span><span class="o">*</span><span class="n">r</span><span class="p">[</span><span class="mi">0</span><span class="p">,:]</span> <span class="o">-</span> <span class="n">sin_Omega</span><span class="o">*</span><span class="n">r</span><span class="p">[</span><span class="mi">1</span><span class="p">,:]</span><span class="o">*</span><span class="n">cos_i</span>
    <span class="n">r</span><span class="p">[</span><span class="mi">1</span><span class="p">,:]</span> <span class="o">=</span> <span class="n">sin_Omega</span><span class="o">*</span><span class="n">x_tmp</span>  <span class="o">+</span> <span class="n">cos_Omega</span><span class="o">*</span><span class="n">r</span><span class="p">[</span><span class="mi">1</span><span class="p">,:]</span><span class="o">*</span><span class="n">cos_i</span>

    <span class="n">l1</span> <span class="o">=</span> <span class="n">cos_Omega</span><span class="o">*</span><span class="n">cos_w</span> <span class="o">-</span> <span class="n">sin_Omega</span><span class="o">*</span><span class="n">sin_w</span><span class="o">*</span><span class="n">cos_i</span>
    <span class="n">l2</span> <span class="o">=</span> <span class="o">-</span><span class="n">cos_Omega</span><span class="o">*</span><span class="n">sin_w</span> <span class="o">-</span> <span class="n">sin_Omega</span><span class="o">*</span><span class="n">cos_w</span><span class="o">*</span><span class="n">cos_i</span>
    <span class="n">m1</span> <span class="o">=</span> <span class="n">sin_Omega</span><span class="o">*</span><span class="n">cos_w</span> <span class="o">+</span> <span class="n">cos_Omega</span><span class="o">*</span><span class="n">sin_w</span><span class="o">*</span><span class="n">cos_i</span>
    <span class="n">m2</span> <span class="o">=</span> <span class="o">-</span><span class="n">sin_Omega</span><span class="o">*</span><span class="n">sin_w</span> <span class="o">+</span> <span class="n">cos_Omega</span><span class="o">*</span><span class="n">cos_w</span><span class="o">*</span><span class="n">cos_i</span>
    <span class="n">n1</span> <span class="o">=</span> <span class="n">sin_w</span><span class="o">*</span><span class="n">sin_i</span>
    <span class="n">n2</span> <span class="o">=</span> <span class="n">cos_w</span><span class="o">*</span><span class="n">sin_i</span>
    <span class="n">b</span> <span class="o">=</span> <span class="n">a</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mf">1.0</span> <span class="o">-</span> <span class="n">e</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
    <span class="n">n</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">mu</span><span class="o">/</span><span class="n">a</span><span class="o">**</span><span class="mi">3</span><span class="p">)</span>
    <span class="n">nar</span> <span class="o">=</span> <span class="n">n</span><span class="o">*</span><span class="n">a</span><span class="o">/</span><span class="n">rn</span>
    
    <span class="n">v</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span> <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="n">o</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">o</span><span class="o">.</span><span class="n">dtype</span> <span class="p">)</span>
    <span class="n">bcos_E</span> <span class="o">=</span> <span class="n">b</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">Ecc</span><span class="p">)</span>
    <span class="n">asin_E</span> <span class="o">=</span> <span class="n">a</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">Ecc</span><span class="p">)</span>

    <span class="n">v</span><span class="p">[</span><span class="mi">0</span><span class="p">,:]</span> <span class="o">=</span> <span class="n">l2</span><span class="o">*</span><span class="n">bcos_E</span> <span class="o">-</span> <span class="n">l1</span><span class="o">*</span><span class="n">asin_E</span>
    <span class="n">v</span><span class="p">[</span><span class="mi">1</span><span class="p">,:]</span> <span class="o">=</span> <span class="n">m2</span><span class="o">*</span><span class="n">bcos_E</span> <span class="o">-</span> <span class="n">m1</span><span class="o">*</span><span class="n">asin_E</span>
    <span class="n">v</span><span class="p">[</span><span class="mi">2</span><span class="p">,:]</span> <span class="o">=</span> <span class="n">n2</span><span class="o">*</span><span class="n">bcos_E</span> <span class="o">-</span> <span class="n">n1</span><span class="o">*</span><span class="n">asin_E</span>

    <span class="n">v</span> <span class="o">=</span> <span class="n">nar</span><span class="o">*</span><span class="n">v</span>

    <span class="n">x</span><span class="p">[:</span><span class="mi">3</span><span class="p">,:]</span> <span class="o">=</span> <span class="n">r</span>
    <span class="n">x</span><span class="p">[</span><span class="mi">3</span><span class="p">:,:]</span> <span class="o">=</span> <span class="n">v</span>

    <span class="k">if</span> <span class="n">input_is_vector</span><span class="p">:</span>
        <span class="n">x</span><span class="o">.</span><span class="n">shape</span> <span class="o">=</span> <span class="p">(</span><span class="mi">6</span><span class="p">,)</span>
        <span class="n">o</span><span class="o">.</span><span class="n">shape</span> <span class="o">=</span> <span class="p">(</span><span class="mi">6</span><span class="p">,)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">radians</span><span class="p">:</span>
            <span class="n">o</span><span class="p">[</span><span class="mi">2</span><span class="p">:]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">degrees</span><span class="p">(</span><span class="n">o</span><span class="p">[</span><span class="mi">2</span><span class="p">:])</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">radians</span><span class="p">:</span>
            <span class="n">o</span><span class="p">[</span><span class="mi">2</span><span class="p">:,:]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">degrees</span><span class="p">(</span><span class="n">o</span><span class="p">[</span><span class="mi">2</span><span class="p">:,:])</span>


    <span class="k">return</span> <span class="n">x</span></div>


<div class="viewcode-block" id="gmst"><a class="viewcode-back" href="../modules/dpt_tools.html#dpt_tools.gmst">[docs]</a><span class="k">def</span> <span class="nf">gmst</span><span class="p">(</span><span class="n">mjd_UT1</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Returns the Greenwich Mean Sidereal Time (rotation of the earth) at a specific UTC Modified Julian Date.</span>
<span class="sd">    Defined as the hour angle between the meridian of Greenwich and mean equinox of date at 0 h UT1</span>
<span class="sd">    </span>
<span class="sd">    :param float/numpy.ndarray mjd_UT1: UTC Modified Julian Date.</span>
<span class="sd">    :return: Greenwich Mean Sidereal Time in radians between 0 and :math:`2\pi`.</span>
<span class="sd">    </span>
<span class="sd">    *Reference:* Montenbruck &amp; Gill: Satellite orbits</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">frac</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">a</span><span class="p">:</span> <span class="n">a</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
    
    <span class="n">secs</span> <span class="o">=</span> <span class="mf">86400.0</span> <span class="c1"># Seconds per day</span>
    <span class="n">MJD_J2000</span> <span class="o">=</span> <span class="mf">51544.5</span>

    <span class="c1"># Mean Sidereal Time</span>
    <span class="n">mjd_0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="n">mjd_UT1</span><span class="p">)</span>
    <span class="n">UT1</span> <span class="o">=</span> <span class="n">secs</span><span class="o">*</span><span class="p">(</span><span class="n">mjd_UT1</span> <span class="o">-</span> <span class="n">mjd_0</span><span class="p">)</span>
    <span class="n">T_0</span> <span class="o">=</span> <span class="p">(</span><span class="n">mjd_0</span> <span class="o">-</span> <span class="n">MJD_J2000</span><span class="p">)</span><span class="o">/</span><span class="mf">36525.0</span>
    <span class="n">T</span> <span class="o">=</span> <span class="p">(</span><span class="n">mjd_UT1</span> <span class="o">-</span> <span class="n">MJD_J2000</span><span class="p">)</span><span class="o">/</span><span class="mf">36525.0</span>
    
    <span class="n">gmst</span> <span class="o">=</span> <span class="mf">24110.54841</span> \
        <span class="o">+</span> <span class="mf">8640184.812866</span><span class="o">*</span><span class="n">T_0</span> \
        <span class="o">+</span> <span class="mf">1.002737909350795</span><span class="o">*</span><span class="n">UT1</span> \
        <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">multiply</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">multiply</span><span class="p">((</span><span class="mf">0.093104</span> <span class="o">-</span> <span class="mf">6.2e-6</span><span class="o">*</span><span class="n">T</span><span class="p">),</span> <span class="n">T</span><span class="p">),</span> <span class="n">T</span><span class="p">)</span>
                
    <span class="k">return</span> <span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="n">frac</span><span class="p">(</span><span class="n">gmst</span><span class="o">/</span><span class="n">secs</span><span class="p">)</span></div>

   
<div class="viewcode-block" id="date_to_jd"><a class="viewcode-back" href="../modules/dpt_tools.html#dpt_tools.date_to_jd">[docs]</a><span class="k">def</span> <span class="nf">date_to_jd</span><span class="p">(</span><span class="n">year</span><span class="p">,</span><span class="n">month</span><span class="p">,</span><span class="n">day</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Convert a date to Julian Day.</span>
<span class="sd">    </span>
<span class="sd">    :param int year: Year as integer. Years preceding 1 A.D. should be 0 or negative. The year before 1 A.D. is 0, 10 B.C. is year -9.</span>
<span class="sd">    :param int month: Month as integer, Jan = 1, Feb. = 2, etc.</span>
<span class="sd">    :param float day:  Day, may contain fractional part.</span>

<span class="sd">    :return: (float) Julian Day</span>
<span class="sd">    </span>
<span class="sd">    **Example:**</span>

<span class="sd">        Convert 6 a.m., February 17, 1985 to Julian Day</span>
<span class="sd">        </span>
<span class="sd">        .. code-block:: python</span>

<span class="sd">           &gt;&gt;&gt; date_to_jd(1985,2,17.25)</span>
<span class="sd">           2446113.75</span>
<span class="sd">    </span>

<span class="sd">    *Reference:* &#39;Practical Astronomy with your Calculator or Spreadsheet&#39;, 4th ed., Duffet-Smith and Zwart, 2011.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">month</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">or</span> <span class="n">month</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
        <span class="n">yearp</span> <span class="o">=</span> <span class="n">year</span> <span class="o">-</span> <span class="mi">1</span>
        <span class="n">monthp</span> <span class="o">=</span> <span class="n">month</span> <span class="o">+</span> <span class="mi">12</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">yearp</span> <span class="o">=</span> <span class="n">year</span>
        <span class="n">monthp</span> <span class="o">=</span> <span class="n">month</span>
    
    <span class="c1"># this checks where we are in relation to October 15, 1582, the beginning</span>
    <span class="c1"># of the Gregorian calendar.</span>
    <span class="k">if</span> <span class="p">((</span><span class="n">year</span> <span class="o">&lt;</span> <span class="mi">1582</span><span class="p">)</span> <span class="ow">or</span>
        <span class="p">(</span><span class="n">year</span> <span class="o">==</span> <span class="mi">1582</span> <span class="ow">and</span> <span class="n">month</span> <span class="o">&lt;</span> <span class="mi">10</span><span class="p">)</span> <span class="ow">or</span>
        <span class="p">(</span><span class="n">year</span> <span class="o">==</span> <span class="mi">1582</span> <span class="ow">and</span> <span class="n">month</span> <span class="o">==</span> <span class="mi">10</span> <span class="ow">and</span> <span class="n">day</span> <span class="o">&lt;</span> <span class="mi">15</span><span class="p">)):</span>
        <span class="c1"># before start of Gregorian calendar</span>
        <span class="n">B</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># after start of Gregorian calendar</span>
        <span class="n">A</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">trunc</span><span class="p">(</span><span class="n">yearp</span> <span class="o">/</span> <span class="mf">100.</span><span class="p">)</span>
        <span class="n">B</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">-</span> <span class="n">A</span> <span class="o">+</span> <span class="n">math</span><span class="o">.</span><span class="n">trunc</span><span class="p">(</span><span class="n">A</span> <span class="o">/</span> <span class="mf">4.</span><span class="p">)</span>
        
    <span class="k">if</span> <span class="n">yearp</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">C</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">trunc</span><span class="p">((</span><span class="mf">365.25</span> <span class="o">*</span> <span class="n">yearp</span><span class="p">)</span> <span class="o">-</span> <span class="mf">0.75</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">C</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">trunc</span><span class="p">(</span><span class="mf">365.25</span> <span class="o">*</span> <span class="n">yearp</span><span class="p">)</span>
        
    <span class="n">D</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">trunc</span><span class="p">(</span><span class="mf">30.6001</span> <span class="o">*</span> <span class="p">(</span><span class="n">monthp</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span>
    
    <span class="n">jd</span> <span class="o">=</span> <span class="n">B</span> <span class="o">+</span> <span class="n">C</span> <span class="o">+</span> <span class="n">D</span> <span class="o">+</span> <span class="n">day</span> <span class="o">+</span> <span class="mf">1720994.5</span>
    
    <span class="k">return</span> <span class="n">jd</span></div>
    

<div class="viewcode-block" id="yearday_to_monthday"><a class="viewcode-back" href="../modules/dpt_tools.html#dpt_tools.yearday_to_monthday">[docs]</a><span class="k">def</span> <span class="nf">yearday_to_monthday</span><span class="p">(</span><span class="n">year_day</span><span class="p">,</span> <span class="n">leap</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Convert a day of the year to a month-day pair.</span>
<span class="sd">    Only takes first order leap-year into account. The day of the year is actually counted so that it starts from 1, so that 1.0 corresponds to January 1 00:00.</span>

<span class="sd">    :param float year_day: Day of the year.</span>
<span class="sd">    :param bool leap: Indicates of the year is a leap year or not.</span>

<span class="sd">    :return: tuple of (month, day)</span>
<span class="sd">    </span>
<span class="sd">    **Example:**</span>
<span class="sd">        </span>
<span class="sd">        .. code-block:: python</span>

<span class="sd">           &gt;&gt;&gt; yearday_to_monthday(1.1, False)</span>
<span class="sd">           (1.0, 1.1)</span>
<span class="sd">           &gt;&gt;&gt; yearday_to_monthday(31.1, False)</span>
<span class="sd">           (1.0, 31.1)</span>
<span class="sd">           &gt;&gt;&gt; yearday_to_monthday(32.1, False)</span>
<span class="sd">           (2.0, 1.1)</span>


<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">days_of_month</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span>
        <span class="mi">1</span><span class="p">,</span>
        <span class="mi">31</span><span class="p">,</span>
        <span class="mi">28</span><span class="p">,</span>
        <span class="mi">31</span><span class="p">,</span>
        <span class="mi">30</span><span class="p">,</span>
        <span class="mi">31</span><span class="p">,</span>
        <span class="mi">30</span><span class="p">,</span>
        <span class="mi">31</span><span class="p">,</span>
        <span class="mi">31</span><span class="p">,</span>
        <span class="mi">30</span><span class="p">,</span>
        <span class="mi">31</span><span class="p">,</span>
        <span class="mi">30</span><span class="p">,</span>
        <span class="mi">31</span><span class="p">,</span>
    <span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">leap</span><span class="p">:</span>
        <span class="n">days_of_month</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="n">cum_days</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cumsum</span><span class="p">(</span><span class="n">days_of_month</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float</span><span class="p">)</span>
    <span class="n">month</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">year_day</span> <span class="o">&lt;</span> <span class="n">cum_days</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span>
    <span class="n">day</span> <span class="o">=</span> <span class="n">year_day</span> <span class="o">-</span> <span class="p">(</span><span class="n">cum_days</span><span class="p">[</span><span class="n">month</span><span class="p">]</span> <span class="o">-</span> <span class="mf">1.0</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">month</span> <span class="o">+</span> <span class="mf">1.0</span><span class="p">,</span> <span class="n">day</span></div>


<div class="viewcode-block" id="unix_to_jd"><a class="viewcode-back" href="../modules/dpt_tools.html#dpt_tools.unix_to_jd">[docs]</a><span class="k">def</span> <span class="nf">unix_to_jd</span><span class="p">(</span><span class="n">unix</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Convert Unix time to JD UT1</span>

<span class="sd">    Constant is due to 0h Jan 1, 1970 = 2440587.5 JD</span>

<span class="sd">    :param float/numpy.ndarray unix: Unix time in seconds.</span>
<span class="sd">    :return: Julian Date UT1</span>
<span class="sd">    :rtype: float/numpy.ndarray</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">return</span> <span class="n">unix</span><span class="o">/</span><span class="mf">86400.0</span> <span class="o">+</span> <span class="mf">2440587.5</span></div>


<div class="viewcode-block" id="npdt2date"><a class="viewcode-back" href="../modules/dpt_tools.html#dpt_tools.npdt2date">[docs]</a><span class="k">def</span> <span class="nf">npdt2date</span><span class="p">(</span><span class="n">dt</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;    </span>
<span class="sd">    Converts a numpy datetime64 value to a date tuple</span>

<span class="sd">    :param numpy.datetime64 dt: Date and time (UTC) in numpy datetime64 format</span>

<span class="sd">    :return: tuple (year, month, day, hours, minutes, seconds, microsecond)</span>
<span class="sd">             all except usec are integer</span>
<span class="sd">    &#39;&#39;&#39;</span>

    <span class="n">t0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">datetime64</span><span class="p">(</span><span class="s1">&#39;1970-01-01&#39;</span><span class="p">,</span> <span class="s1">&#39;s&#39;</span><span class="p">)</span>
    <span class="n">ts</span> <span class="o">=</span> <span class="p">(</span><span class="n">dt</span> <span class="o">-</span> <span class="n">t0</span><span class="p">)</span><span class="o">/</span><span class="n">sec</span>

    <span class="n">it</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="n">ts</span><span class="p">))</span>
    <span class="n">usec</span> <span class="o">=</span> <span class="mf">1e6</span> <span class="o">*</span> <span class="p">(</span><span class="n">dt</span> <span class="o">-</span> <span class="p">(</span><span class="n">t0</span> <span class="o">+</span> <span class="n">it</span><span class="o">*</span><span class="n">sec</span><span class="p">))</span><span class="o">/</span><span class="n">sec</span>

    <span class="n">tm</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">localtime</span><span class="p">(</span><span class="n">it</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">tm</span><span class="o">.</span><span class="n">tm_year</span><span class="p">,</span> <span class="n">tm</span><span class="o">.</span><span class="n">tm_mon</span><span class="p">,</span> <span class="n">tm</span><span class="o">.</span><span class="n">tm_mday</span><span class="p">,</span> <span class="n">tm</span><span class="o">.</span><span class="n">tm_hour</span><span class="p">,</span> <span class="n">tm</span><span class="o">.</span><span class="n">tm_min</span><span class="p">,</span> <span class="n">tm</span><span class="o">.</span><span class="n">tm_sec</span><span class="p">,</span> <span class="n">usec</span></div>


<div class="viewcode-block" id="npdt2mjd"><a class="viewcode-back" href="../modules/dpt_tools.html#dpt_tools.npdt2mjd">[docs]</a><span class="k">def</span> <span class="nf">npdt2mjd</span><span class="p">(</span><span class="n">dt</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Converts a numpy datetime64 value (UTC) to a modified Julian date</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">dt</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">datetime64</span><span class="p">(</span><span class="s1">&#39;1858-11-17&#39;</span><span class="p">))</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">timedelta64</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;D&#39;</span><span class="p">)</span></div>


<div class="viewcode-block" id="mjd2npdt"><a class="viewcode-back" href="../modules/dpt_tools.html#dpt_tools.mjd2npdt">[docs]</a><span class="k">def</span> <span class="nf">mjd2npdt</span><span class="p">(</span><span class="n">mjd</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Converts a modified Julian date to a numpy datetime64 value (UTC)</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">day</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">timedelta64</span><span class="p">(</span><span class="mi">24</span><span class="o">*</span><span class="mi">3600</span><span class="o">*</span><span class="mi">1000</span><span class="o">*</span><span class="mi">1000</span><span class="p">,</span> <span class="s1">&#39;us&#39;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">datetime64</span><span class="p">(</span><span class="s1">&#39;1858-11-17&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="n">day</span> <span class="o">*</span> <span class="n">mjd</span></div>


<div class="viewcode-block" id="unix2npdt"><a class="viewcode-back" href="../modules/dpt_tools.html#dpt_tools.unix2npdt">[docs]</a><span class="k">def</span> <span class="nf">unix2npdt</span><span class="p">(</span><span class="n">unix</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">datetime64</span><span class="p">(</span><span class="s1">&#39;1970-01-01&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">timedelta64</span><span class="p">(</span><span class="mi">1000</span><span class="o">*</span><span class="mi">1000</span><span class="p">,</span><span class="s1">&#39;us&#39;</span><span class="p">)</span><span class="o">*</span><span class="n">unix</span></div>

<div class="viewcode-block" id="npdt2unix"><a class="viewcode-back" href="../modules/dpt_tools.html#dpt_tools.npdt2unix">[docs]</a><span class="k">def</span> <span class="nf">npdt2unix</span><span class="p">(</span><span class="n">dt</span><span class="p">):</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">dt</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">datetime64</span><span class="p">(</span><span class="s1">&#39;1970-01-01&#39;</span><span class="p">))</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">timedelta64</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="s1">&#39;s&#39;</span><span class="p">)</span></div>


<div class="viewcode-block" id="jd_to_unix"><a class="viewcode-back" href="../modules/dpt_tools.html#dpt_tools.jd_to_unix">[docs]</a><span class="k">def</span> <span class="nf">jd_to_unix</span><span class="p">(</span><span class="n">jd_ut1</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Convert JD UT1 time to Unix time</span>
<span class="sd">    </span>
<span class="sd">    Constant is due to 0h Jan 1, 1970 = 2440587.5 JD</span>

<span class="sd">    :param float/numpy.ndarray jd_ut1: Julian Date UT1</span>
<span class="sd">    :return: Unix time in seconds</span>
<span class="sd">    :rtype: float/numpy.ndarray</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">jd_ut1</span> <span class="o">-</span> <span class="mf">2440587.5</span><span class="p">)</span><span class="o">*</span><span class="mf">86400.0</span></div>


<div class="viewcode-block" id="jd_to_mjd"><a class="viewcode-back" href="../modules/dpt_tools.html#dpt_tools.jd_to_mjd">[docs]</a><span class="k">def</span> <span class="nf">jd_to_mjd</span><span class="p">(</span><span class="n">jd</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Convert Julian Date (relative 12h Jan 1, 4713 BC) to Modified Julian Date (relative 0h Nov 17, 1858)</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">return</span> <span class="n">jd</span> <span class="o">-</span> <span class="mf">2400000.5</span></div>


<div class="viewcode-block" id="mjd_to_jd"><a class="viewcode-back" href="../modules/dpt_tools.html#dpt_tools.mjd_to_jd">[docs]</a><span class="k">def</span> <span class="nf">mjd_to_jd</span><span class="p">(</span><span class="n">mjd</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Convert Modified Julian Date (relative 0h Nov 17, 1858) to Julian Date (relative 12h Jan 1, 4713 BC)</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">return</span> <span class="n">mjd</span> <span class="o">+</span> <span class="mf">2400000.5</span></div>


<div class="viewcode-block" id="mjd_to_j2000"><a class="viewcode-back" href="../modules/dpt_tools.html#dpt_tools.mjd_to_j2000">[docs]</a><span class="k">def</span> <span class="nf">mjd_to_j2000</span><span class="p">(</span><span class="n">mjd_tt</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Convert from Modified Julian Date to days past J2000.</span>
<span class="sd">    </span>
<span class="sd">    :param float/numpy.ndarray mjd_tt: MJD in TT</span>
<span class="sd">    :return: Days past J2000</span>
<span class="sd">    :rtype: float/numpy.ndarray</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">return</span> <span class="n">mjd_to_jd</span><span class="p">(</span><span class="n">mjd_tt</span><span class="p">)</span> <span class="o">-</span> <span class="mf">2451545.0</span></div>


<div class="viewcode-block" id="jd_to_date"><a class="viewcode-back" href="../modules/dpt_tools.html#dpt_tools.jd_to_date">[docs]</a><span class="k">def</span> <span class="nf">jd_to_date</span><span class="p">(</span><span class="n">jd</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Convert Julian Day to date.</span>
<span class="sd">    </span>
<span class="sd">    :param float jd: Julian Day</span>
<span class="sd">    :return: Tuple consisting of year, month and day</span>
<span class="sd">    :rtype: tuple</span>

<span class="sd">    **Return tuple:**</span>
<span class="sd">       :year: (int) Year as integer. Years preceding 1 A.D. should be 0 or negative. The year before 1 A.D. is 0, 10 B.C. is year -9.</span>
<span class="sd">       :month: (int) Month as integer, Jan = 1, Feb. = 2, etc.</span>
<span class="sd">       :day: (float) Day, may contain fractional part.</span>

<span class="sd">    **Example:**</span>

<span class="sd">       Convert Julian Day 2446113.75 to year, month, and day.</span>

<span class="sd">       .. code-block:: python</span>

<span class="sd">          &gt;&gt;&gt; jd_to_date(2446113.75)</span>
<span class="sd">          (1985, 2, 17.25)</span>
<span class="sd">    </span>

<span class="sd">    *Reference:* &#39;Practical Astronomy with your Calculator or Spreadsheet&#39;, 4th ed., Duffet-Smith and Zwart, 2011.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">jd</span> <span class="o">=</span> <span class="n">jd</span> <span class="o">+</span> <span class="mf">0.5</span>
    
    <span class="n">F</span><span class="p">,</span> <span class="n">I</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">modf</span><span class="p">(</span><span class="n">jd</span><span class="p">)</span>
    <span class="n">I</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">I</span><span class="p">)</span>
    
    <span class="n">A</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">trunc</span><span class="p">((</span><span class="n">I</span> <span class="o">-</span> <span class="mf">1867216.25</span><span class="p">)</span><span class="o">/</span><span class="mf">36524.25</span><span class="p">)</span>
    
    <span class="k">if</span> <span class="n">I</span> <span class="o">&gt;</span> <span class="mi">2299160</span><span class="p">:</span>
        <span class="n">B</span> <span class="o">=</span> <span class="n">I</span> <span class="o">+</span> <span class="mi">1</span> <span class="o">+</span> <span class="n">A</span> <span class="o">-</span> <span class="n">math</span><span class="o">.</span><span class="n">trunc</span><span class="p">(</span><span class="n">A</span> <span class="o">/</span> <span class="mf">4.</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">B</span> <span class="o">=</span> <span class="n">I</span>
        
    <span class="n">C</span> <span class="o">=</span> <span class="n">B</span> <span class="o">+</span> <span class="mi">1524</span>
    
    <span class="n">D</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">trunc</span><span class="p">((</span><span class="n">C</span> <span class="o">-</span> <span class="mf">122.1</span><span class="p">)</span> <span class="o">/</span> <span class="mf">365.25</span><span class="p">)</span>
    
    <span class="n">E</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">trunc</span><span class="p">(</span><span class="mf">365.25</span> <span class="o">*</span> <span class="n">D</span><span class="p">)</span>
    
    <span class="n">G</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">trunc</span><span class="p">((</span><span class="n">C</span> <span class="o">-</span> <span class="n">E</span><span class="p">)</span> <span class="o">/</span> <span class="mf">30.6001</span><span class="p">)</span>
    
    <span class="n">day</span> <span class="o">=</span> <span class="n">C</span> <span class="o">-</span> <span class="n">E</span> <span class="o">+</span> <span class="n">F</span> <span class="o">-</span> <span class="n">math</span><span class="o">.</span><span class="n">trunc</span><span class="p">(</span><span class="mf">30.6001</span> <span class="o">*</span> <span class="n">G</span><span class="p">)</span>
    
    <span class="k">if</span> <span class="n">G</span> <span class="o">&lt;</span> <span class="mf">13.5</span><span class="p">:</span>
        <span class="n">month</span> <span class="o">=</span> <span class="n">G</span> <span class="o">-</span> <span class="mi">1</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">month</span> <span class="o">=</span> <span class="n">G</span> <span class="o">-</span> <span class="mi">13</span>
        
    <span class="k">if</span> <span class="n">month</span> <span class="o">&gt;</span> <span class="mf">2.5</span><span class="p">:</span>
        <span class="n">year</span> <span class="o">=</span> <span class="n">D</span> <span class="o">-</span> <span class="mi">4716</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">year</span> <span class="o">=</span> <span class="n">D</span> <span class="o">-</span> <span class="mi">4715</span>
        
    <span class="k">return</span> <span class="n">year</span><span class="p">,</span> <span class="n">month</span><span class="p">,</span> <span class="n">day</span></div>


<span class="k">def</span> <span class="nf">_plot_orb_inst</span><span class="p">(</span><span class="n">res</span><span class="p">,</span> <span class="n">orb_init</span><span class="p">,</span> <span class="n">get_orbit</span><span class="p">):</span>

    <span class="n">o</span> <span class="o">=</span> <span class="n">_gen_orbit</span><span class="p">(</span><span class="n">orb_init</span><span class="p">,</span> <span class="n">res</span><span class="p">)</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="n">o</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">o</span><span class="o">.</span><span class="n">dtype</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">o</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]):</span>
        <span class="n">state</span> <span class="o">=</span> <span class="n">get_orbit</span><span class="p">(</span><span class="n">o</span><span class="p">[:,</span><span class="n">i</span><span class="p">])</span>
        <span class="n">state</span><span class="o">.</span><span class="n">shape</span> <span class="o">=</span> <span class="p">(</span><span class="mi">6</span><span class="p">,)</span>
        <span class="n">x</span><span class="p">[:,</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">state</span>

    <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span><span class="mi">15</span><span class="p">))</span>
    <span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">111</span><span class="p">,</span> <span class="n">projection</span><span class="o">=</span><span class="s1">&#39;3d&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">view_init</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>

    <span class="n">max_range</span> <span class="o">=</span> <span class="n">orb_init</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="mf">1.1</span>

    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="n">max_range</span><span class="p">],[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">],[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">],</span><span class="s2">&quot;-k&quot;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="n">max_range</span><span class="p">],[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">],[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">],</span><span class="s2">&quot;-k&quot;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;+x&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">],[</span><span class="mi">0</span><span class="p">,</span><span class="n">max_range</span><span class="p">],[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">],</span><span class="s2">&quot;-b&quot;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;+y&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="o">-</span><span class="n">max_range</span><span class="p">,</span> <span class="n">max_range</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="o">-</span><span class="n">max_range</span><span class="p">,</span> <span class="n">max_range</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_zlim</span><span class="p">(</span><span class="o">-</span><span class="n">max_range</span><span class="p">,</span> <span class="n">max_range</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="mf">0.0</span><span class="p">],[</span><span class="mf">0.0</span><span class="p">],[</span><span class="mf">0.0</span><span class="p">],</span><span class="s2">&quot;xk&quot;</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;Focus point&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">,:],</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">,:],</span><span class="n">x</span><span class="p">[</span><span class="mi">2</span><span class="p">,:],</span><span class="s2">&quot;.k&quot;</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;Converted elements&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]],[</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">]],[</span><span class="n">x</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span><span class="mi">0</span><span class="p">]],</span><span class="s2">&quot;or&quot;</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;$</span><span class="se">\\</span><span class="s1">nu = 0$&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="nb">int</span><span class="p">(</span><span class="n">res</span><span class="o">//</span><span class="mi">4</span><span class="p">)]],[</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="nb">int</span><span class="p">(</span><span class="n">res</span><span class="o">//</span><span class="mi">4</span><span class="p">)]],[</span><span class="n">x</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span><span class="nb">int</span><span class="p">(</span><span class="n">res</span><span class="o">//</span><span class="mi">4</span><span class="p">)]],</span><span class="s2">&quot;oy&quot;</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;$</span><span class="se">\\</span><span class="s1">nu = 0.5\pi$&#39;</span><span class="p">)</span>

    <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Kep -&gt; cart: a=</span><span class="si">{}</span><span class="s2"> km, e=</span><span class="si">{}</span><span class="s2">, inc=</span><span class="si">{}</span><span class="s2"> deg, omega=</span><span class="si">{}</span><span class="s2"> deg, Omega=</span><span class="si">{}</span><span class="s2"> deg &quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
        <span class="n">orb_init</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="mf">1e-3</span><span class="p">,</span>
        <span class="n">orb_init</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
        <span class="n">orb_init</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span>
        <span class="n">orb_init</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span>
        <span class="n">orb_init</span><span class="p">[</span><span class="mi">4</span><span class="p">],</span>
    <span class="p">))</span>

<span class="k">def</span> <span class="nf">_gen_orbit</span><span class="p">(</span><span class="n">orb_init</span><span class="p">,</span> <span class="n">res</span><span class="p">):</span>
    <span class="n">o</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">((</span><span class="mi">6</span><span class="p">,</span><span class="n">res</span><span class="p">),</span><span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float</span><span class="p">)</span>
    <span class="n">nu</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mf">360.0</span><span class="p">,</span> <span class="n">num</span><span class="o">=</span><span class="n">res</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">res</span><span class="p">):</span>
        <span class="n">o</span><span class="p">[:</span><span class="mi">5</span><span class="p">,</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">orb_init</span>
        <span class="n">o</span><span class="p">[</span><span class="mi">5</span><span class="p">,</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">nu</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">o</span>


<div class="viewcode-block" id="ascending_node_from_statevector"><a class="viewcode-back" href="../modules/dpt_tools.html#dpt_tools.ascending_node_from_statevector">[docs]</a><span class="k">def</span> <span class="nf">ascending_node_from_statevector</span><span class="p">(</span><span class="n">sv</span><span class="p">,</span> <span class="n">m</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    keywords include</span>
<span class="sd">      M_cent = &#39;central mass&#39;</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">cart</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">r_</span><span class="p">[</span><span class="n">sv</span><span class="p">[</span><span class="s1">&#39;pos&#39;</span><span class="p">],</span> <span class="n">sv</span><span class="p">[</span><span class="s1">&#39;vel&#39;</span><span class="p">]]</span>
    <span class="n">a</span><span class="p">,</span> <span class="n">e</span><span class="p">,</span> <span class="n">inc</span><span class="p">,</span> <span class="n">aop</span><span class="p">,</span> <span class="n">raan</span><span class="p">,</span> <span class="n">mu0p</span> <span class="o">=</span> <span class="n">cart2kep</span><span class="p">(</span><span class="n">cart</span><span class="p">,</span> <span class="n">m</span><span class="o">=</span><span class="n">m</span><span class="p">,</span> <span class="n">M_cent</span><span class="o">=</span><span class="n">M_earth</span><span class="p">,</span> <span class="n">radians</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">)</span>
    <span class="n">mu0</span> <span class="o">=</span> <span class="n">true2mean</span><span class="p">(</span><span class="n">mu0p</span><span class="p">,</span> <span class="n">e</span><span class="p">,</span> <span class="n">radians</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

    <span class="n">ttan</span> <span class="o">=</span> <span class="n">find_ascending_node_time</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">e</span><span class="p">,</span> <span class="n">aop</span><span class="p">,</span> <span class="n">mu0</span><span class="p">,</span> <span class="n">m</span><span class="p">,</span> <span class="n">radians</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">sec</span> <span class="o">*</span> <span class="n">ttan</span></div>


<div class="viewcode-block" id="find_ascending_node_time"><a class="viewcode-back" href="../modules/dpt_tools.html#dpt_tools.find_ascending_node_time">[docs]</a><span class="k">def</span> <span class="nf">find_ascending_node_time</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">e</span><span class="p">,</span> <span class="n">aop</span><span class="p">,</span> <span class="n">mu0</span><span class="p">,</span> <span class="n">m</span><span class="p">,</span> <span class="n">radians</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Find the time past the crossing of the ascending node.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">if</span> <span class="n">radians</span><span class="p">:</span>
        <span class="n">one_lap</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="mf">2.0</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">one_lap</span> <span class="o">=</span> <span class="mf">360.0</span>

    <span class="n">gravitational_param</span> <span class="o">=</span> <span class="n">scipy</span><span class="o">.</span><span class="n">constants</span><span class="o">.</span><span class="n">G</span><span class="o">*</span><span class="p">(</span><span class="n">M_earth</span> <span class="o">+</span> <span class="n">m</span><span class="p">)</span>
    <span class="n">mean_motion</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">gravitational_param</span><span class="o">/</span><span class="p">(</span><span class="n">a</span><span class="o">**</span><span class="mf">3.0</span><span class="p">))</span><span class="o">/</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="mf">2.0</span><span class="p">)</span><span class="o">*</span><span class="n">one_lap</span>

    <span class="n">true_at_asc_node</span> <span class="o">=</span> <span class="n">one_lap</span> <span class="o">-</span> <span class="n">aop</span>
    <span class="n">mean_at_asc_node</span> <span class="o">=</span> <span class="n">true2mean</span><span class="p">(</span><span class="n">true_at_asc_node</span><span class="p">,</span> <span class="n">e</span><span class="p">,</span> <span class="n">radians</span><span class="o">=</span><span class="n">radians</span><span class="p">)</span>

    <span class="n">md</span> <span class="o">=</span> <span class="n">mean_at_asc_node</span> <span class="o">-</span> <span class="n">mu0</span>
    <span class="k">if</span> <span class="n">md</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">md</span> <span class="o">-=</span> <span class="n">one_lap</span>

    <span class="n">time_from_asc_node</span> <span class="o">=</span> <span class="o">-</span><span class="n">md</span><span class="o">/</span><span class="n">mean_motion</span>

    <span class="k">return</span> <span class="n">time_from_asc_node</span></div>


<div class="viewcode-block" id="plot_ref_orbit"><a class="viewcode-back" href="../modules/dpt_tools.html#dpt_tools.plot_ref_orbit">[docs]</a><span class="k">def</span> <span class="nf">plot_ref_orbit</span><span class="p">(</span><span class="n">get_orbit</span><span class="p">,</span> <span class="n">res</span> <span class="o">=</span> <span class="mi">100</span><span class="p">,</span> <span class="n">orb_init</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">10000e3</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">,</span> <span class="mi">70</span><span class="p">,</span> <span class="mi">120</span><span class="p">,</span> <span class="mi">35</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float</span><span class="p">)):</span>
    <span class="sd">&#39;&#39;&#39;Plots a specific reference orbit.</span>

<span class="sd">    :param function get_orbit: A function pointer that takes an Kepler state as input and returns a state vector.</span>
<span class="sd">    </span>
<span class="sd">    The arguments to :code:`get_orbit` should be:</span>
<span class="sd">      * *numpy.ndarray* of Kepler elements.</span>
<span class="sd">      * Use degrees for angles.</span>
<span class="sd">      * Kepler elements are :math:`a`, :math:`e`, :math:`i`, :math:`\omega`, :math:`\Omega`, :math:`\\nu`</span>
<span class="sd">      * See :func:`~dpt_tools.kep2cart`</span>

<span class="sd">    **Example:**</span>

<span class="sd">    .. code-block:: python</span>

<span class="sd">       import dpt_tools as dpt</span>
<span class="sd">       import space_object as so</span>

<span class="sd">       def get_orbit(o):</span>
<span class="sd">           obj=so.space_object(</span>
<span class="sd">               a=o[0],</span>
<span class="sd">               e=o[1],</span>
<span class="sd">               i=o[2],</span>
<span class="sd">               raan=o[4],</span>
<span class="sd">               aop=o[3],</span>
<span class="sd">               mu0=o[5],</span>
<span class="sd">               C_D=2.3,</span>
<span class="sd">               A=1.0,</span>
<span class="sd">               m=1.0</span>
<span class="sd">           )</span>
<span class="sd">           return obj.get_state([0.0])</span>

<span class="sd">       dpt.plot_ref_orbit(get_orbit)</span>

<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">_plot_orb_inst</span><span class="p">(</span><span class="n">res</span><span class="p">,</span> <span class="n">orb_init</span><span class="p">,</span> <span class="n">get_orbit</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span></div>


<div class="viewcode-block" id="plot_orbit_convention"><a class="viewcode-back" href="../modules/dpt_tools.html#dpt_tools.plot_orbit_convention">[docs]</a><span class="k">def</span> <span class="nf">plot_orbit_convention</span><span class="p">(</span><span class="n">get_orbit</span><span class="p">,</span> <span class="n">res</span> <span class="o">=</span> <span class="mi">100</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Plots the orbit convention used by arbitrary function/program</span>

<span class="sd">    :param function get_orbit: A function pointer that takes an Kepler state as input and returns a state vector.</span>
<span class="sd">    </span>
<span class="sd">    The arguments to :code:`get_orbit` should be:</span>
<span class="sd">      * *numpy.ndarray* of Kepler elements.</span>
<span class="sd">      * Use degrees for angles.</span>
<span class="sd">      * Kepler elements are :math:`a`, :math:`e`, :math:`i`, :math:`\omega`, :math:`\Omega`, :math:`\\nu`</span>
<span class="sd">      * See :func:`~dpt_tools.kep2cart`</span>

<span class="sd">    **Example:**</span>

<span class="sd">    .. code-block:: python</span>

<span class="sd">       import dpt_tools as dpt</span>
<span class="sd">       import space_object as so</span>

<span class="sd">       def get_orbit(o):</span>
<span class="sd">           obj=so.space_object(</span>
<span class="sd">               a=o[0],</span>
<span class="sd">               e=o[1],</span>
<span class="sd">               i=o[2],</span>
<span class="sd">               raan=o[4],</span>
<span class="sd">               aop=o[3],</span>
<span class="sd">               mu0=o[5],</span>
<span class="sd">               C_D=2.3,</span>
<span class="sd">               A=1.0,</span>
<span class="sd">               m=1.0</span>
<span class="sd">           )</span>
<span class="sd">           return obj.get_state([0.0])</span>

<span class="sd">       dpt.plot_orbit_convention(get_orbit)</span>

<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">a</span> <span class="o">=</span> <span class="mf">50000e3</span>
    <span class="n">orb_init_list</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">orb_init_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">a</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float</span><span class="p">))</span>
    <span class="n">orb_init_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">a</span><span class="p">,</span> <span class="mf">0.8</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float</span><span class="p">))</span>
    <span class="n">orb_init_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">a</span><span class="p">,</span> <span class="mf">0.8</span><span class="p">,</span> <span class="mf">45.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float</span><span class="p">))</span>
    <span class="n">orb_init_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">a</span><span class="p">,</span> <span class="mf">0.8</span><span class="p">,</span> <span class="mf">45.0</span><span class="p">,</span> <span class="mf">90.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float</span><span class="p">))</span>
    <span class="n">orb_init_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">a</span><span class="p">,</span> <span class="mf">0.8</span><span class="p">,</span> <span class="mf">45.0</span><span class="p">,</span> <span class="mf">90.0</span><span class="p">,</span> <span class="mf">90.0</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float</span><span class="p">))</span>

    <span class="k">for</span> <span class="n">orb_init</span> <span class="ow">in</span> <span class="n">orb_init_list</span><span class="p">:</span>
        <span class="n">_plot_orb_inst</span><span class="p">(</span><span class="n">res</span><span class="p">,</span> <span class="n">orb_init</span><span class="p">,</span> <span class="n">get_orbit</span><span class="p">)</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span></div>


<div class="viewcode-block" id="orbit3D"><a class="viewcode-back" href="../modules/dpt_tools.html#dpt_tools.orbit3D">[docs]</a><span class="k">def</span> <span class="nf">orbit3D</span><span class="p">(</span><span class="n">states</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Create a 3D plot of a set of states.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">if</span> <span class="n">ax</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span><span class="mi">15</span><span class="p">))</span>
        <span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">111</span><span class="p">,</span> <span class="n">projection</span><span class="o">=</span><span class="s1">&#39;3d&#39;</span><span class="p">)</span>

    <span class="n">plothelp</span><span class="o">.</span><span class="n">draw_earth_grid</span><span class="p">(</span><span class="n">ax</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">states</span><span class="p">[</span><span class="mi">0</span><span class="p">,:],</span> <span class="n">states</span><span class="p">[</span><span class="mi">1</span><span class="p">,:],</span> <span class="n">states</span><span class="p">[</span><span class="mi">2</span><span class="p">,:],</span><span class="s2">&quot;-b&quot;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
    <span class="n">max_range</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">states</span><span class="o">.</span><span class="n">flatten</span><span class="p">()))</span><span class="o">*</span><span class="mf">1.1</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="o">-</span><span class="n">max_range</span><span class="p">,</span> <span class="n">max_range</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="o">-</span><span class="n">max_range</span><span class="p">,</span> <span class="n">max_range</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_zlim</span><span class="p">(</span><span class="o">-</span><span class="n">max_range</span><span class="p">,</span> <span class="n">max_range</span><span class="p">)</span>
    
    <span class="k">return</span> <span class="n">ax</span></div>
</pre></div>

          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h3><a href="../index.html">Table of Contents</a></h3>
<p class="caption"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../introduction/introduction.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../introduction/conventions.html">Coordinate conventions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../introduction/more_dependencies.html">Optional dependencies</a></li>
<li class="toctree-l1"><a class="reference internal" href="../introduction/propagators.html">Installing propagators</a></li>
<li class="toctree-l1"><a class="reference internal" href="../introduction/step_by_step.html">Step by step guides</a></li>
<li class="toctree-l1"><a class="reference internal" href="../usage_examples.html">Usage examples</a></li>
<li class="toctree-l1"><a class="reference internal" href="../modules/doc.html">Documentation</a></li>
</ul>

<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">SORTS++ 3.0.0 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="index.html" >Module code</a> &#187;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2019, Daniel Kastinen, Juha Vierinen.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.8.1.
    </div>
  </body>
</html>